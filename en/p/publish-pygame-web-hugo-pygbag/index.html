<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Want to run your Pygame games on the web? Learn how to convert them to WebAssembly using pygbag and embed them in your Hugo blog. Includes an iframe shortcode for plugin-free game publishing."><title>Publish Your Pygame Game on the Web! Easily Embed in Hugo Blog with pygbag (WebAssembly)</title><link rel=canonical href=https://takoyakisoft.com/en/p/publish-pygame-web-hugo-pygbag/><link rel=stylesheet href=/scss/style.min.e2eb4d863e5f9e2d94c38679d645929c395fbab1ed23bbebd5526b205d5c473b.css><meta property='og:title' content="Publish Your Pygame Game on the Web! Easily Embed in Hugo Blog with pygbag (WebAssembly)"><meta property='og:description' content="Want to run your Pygame games on the web? Learn how to convert them to WebAssembly using pygbag and embed them in your Hugo blog. Includes an iframe shortcode for plugin-free game publishing."><meta property='og:url' content='https://takoyakisoft.com/en/p/publish-pygame-web-hugo-pygbag/'><meta property='og:site_name' content='TakoyakiSoft'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Python'><meta property='article:tag' content='Hugo'><meta property='article:published_time' content='2025-03-30T05:18:12+09:00'><meta property='article:modified_time' content='2025-03-30T05:18:12+09:00'><meta property='og:image' content='https://takoyakisoft.com/p/publish-pygame-web-hugo-pygbag/publish-pygame-web-hugo-pygbag.webp'><meta name=twitter:site content="@takoyakisoft"><meta name=twitter:creator content="@takoyakisoft"><meta name=twitter:title content="Publish Your Pygame Game on the Web! Easily Embed in Hugo Blog with pygbag (WebAssembly)"><meta name=twitter:description content="Want to run your Pygame games on the web? Learn how to convert them to WebAssembly using pygbag and embed them in your Hugo blog. Includes an iframe shortcode for plugin-free game publishing."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://takoyakisoft.com/p/publish-pygame-web-hugo-pygbag/publish-pygame-web-hugo-pygbag.webp'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/en/><img src=/img/avatar_hu_f78e84f1474a9757.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üïπÔ∏è</span></figure><div class=site-meta><h1 class=site-name><a href=/en>TakoyakiSoft</a></h1><h2 class=site-description>Explaining how to use various software in an easy-to-understand manner.</h2></div></header><ol class=menu-social><li><a href=https://bsky.app/profile/takoyakisoft.bsky.social target=_blank title=Bluesky rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bluesky"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.335 5.144C4.681 3.945 2 3.017 2 5.97c0 .59.35 4.953.556 5.661C3.269 14.094 5.686 14.381 8 14c-4.045.665-4.889 3.208-2.667 5.41C6.363 20.428 7.246 21 8 21c2 0 3.134-2.769 3.5-3.5.333-.667.5-1.167.5-1.5.0.333.167.833.5 1.5.366.731 1.5 3.5 3.5 3.5.754.0 1.637-.571 2.667-1.59C20.889 17.207 20.045 14.664 16 14c2.314.38 4.73.094 5.444-2.369.206-.708.556-5.072.556-5.661.0-2.953-2.68-2.025-4.335-.826C15.372 6.806 12.905 10.192 12 12c-.905-1.808-3.372-5.194-5.665-6.856z"/></svg></a></li><li><a href=https://github.com/takoyakisoft target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/takoyakisoft target=_blank title=X rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li><li><a href=https://www.youtube.com/@takoyaki-soft target=_blank title=YouTube rel=me><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M2 8a4 4 0 014-4h12a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M10 9l5 3-5 3z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/en/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/en/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/en/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/en/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Social Media Links</span></a></li><li><a href=/en/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-exclamation"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4c.348.0.686.045 1.008.128"/><path d="M19 16v3"/><path d="M19 22v.01"/></svg>
<span>About Us</span></a></li><li><a href=/en/terms-of-service/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 3m0 2a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2H7a2 2 0 01-2-2z"/><path d="M9 7h6"/><path d="M9 11h6"/><path d="M9 15h4"/></svg>
<span>Terms of Service</span></a></li><li><a href=/en/privacy-policy/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-shield-lock"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3a12 12 0 008.5 3A12 12 0 0112 21 12 12 0 013.5 6 12 12 0 0012 3"/><path d="M12 11m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 12v2.5"/></svg>
<span>Privacy Policy</span></a></li><li><a href=/en/disclaimer/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-exclamation-circle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M12 9v4"/><path d="M12 16v.01"/></svg>
<span>Disclaimer</span></a></li><li><a href=/en/contact/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg>
<span>Contact Us</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://takoyakisoft.com/en/ selected>English</option><option value=https://takoyakisoft.com/>Êó•Êú¨Ë™û</option><option value=https://takoyakisoft.com/zh-cn/>ÁÆÄ‰Ωì‰∏≠Êñá</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#the-finished-game>The Finished Game</a></li><li><a href=#building-your-pygame-game-for-the-web-using-the-handy-tool-pygbag>Building Your Pygame Game for the Web: Using the Handy Tool <code>pygbag</code></a><ol><li><a href=#1-first-prepare-your-project-with-uv>1. First, Prepare Your Project with <code>uv</code></a></li><li><a href=#2-now-lets-build-the-game>2. Now, Let&rsquo;s Build the Game</a></li></ol></li><li><a href=#embedding-the-game-in-your-hugo-blog>Embedding the Game in Your Hugo Blog</a><ol><li><a href=#1-regarding-the-location-for-game-files>1. Regarding the Location for Game Files</a></li><li><a href=#2-writing-iframe-tags-every-time-is-tedious-so-lets-create-a-hugo-shortcode>2. Writing <code>&lt;iframe></code> Tags Every Time is Tedious, So Let&rsquo;s Create a Hugo Shortcode</a></li><li><a href=#3-alright-setup-is-complete-lets-use-it-in-a-post>3. Alright, Setup is Complete! Let&rsquo;s Use it in a Post.</a></li></ol></li><li><a href=#summary>Summary</a></li><li><a href=#source-code>Source Code</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/en/p/publish-pygame-web-hugo-pygbag/><img src=/p/publish-pygame-web-hugo-pygbag/publish-pygame-web-hugo-pygbag_hu_3237456d214ac5b6.webp srcset="/p/publish-pygame-web-hugo-pygbag/publish-pygame-web-hugo-pygbag_hu_3237456d214ac5b6.webp 800w, /p/publish-pygame-web-hugo-pygbag/publish-pygame-web-hugo-pygbag_hu_f212cdd79320b444.webp 1600w" width=800 height=450 loading=lazy alt="Featured image of post Publish Your Pygame Game on the Web! Easily Embed in Hugo Blog with pygbag (WebAssembly)"></a></div><div class=article-details><header class=article-category><a href=/en/categories/programming/>Programming
</a><a href=/en/categories/game/>Game</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/en/p/publish-pygame-web-hugo-pygbag/>Publish Your Pygame Game on the Web! Easily Embed in Hugo Blog with pygbag (WebAssembly)</a></h2><h3 class=article-subtitle>Want to run your Pygame games on the web? Learn how to convert them to WebAssembly using pygbag and embed them in your Hugo blog. Includes an iframe shortcode for plugin-free game publishing.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 30, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>28 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://takoyakisoft.com/p/publish-pygame-web-hugo-pygbag/ class=link>Êó•Êú¨Ë™û</a>
<a href=https://takoyakisoft.com/zh-cn/p/publish-pygame-web-hugo-pygbag/ class=link>ÁÆÄ‰Ωì‰∏≠Êñá</a></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p>Hello!</p><p>You&rsquo;ve created your own game with Pygame, and naturally, you want to publish it on the web so many people can play it, right? I feel the same way!</p><p>In this article, we&rsquo;ll explore how to make games created with the Python game library Pygame easily playable by anyone directly in a web browser. I&rsquo;ll try to explain it as clearly as possible.</p><p>What you&rsquo;ll learn in this article:</p><ol><li>How to use a tool called <code>pygbag</code> to convert (build) your Pygame game for the web using WebAssembly (WASM). This is quite convenient.</li><li>The steps to embed the converted game into a blog created with the static site generator Hugo.</li><li>How to create a Hugo shortcode to easily embed the game into your posts. Making this will make things easier later on.</li></ol><p>With these steps, you can make your game playable directly in the browser without needing any special server setup. Isn&rsquo;t that great! Your game might be played by people all over the world!</p><h2 id=the-finished-game>The Finished Game</h2><p>So, here&rsquo;s the game I actually made using this method!
(It&rsquo;s a game you just watch.)</p><div style=position:relative;padding-bottom:75%;height:0;overflow:hidden;max-width:100%;height:auto><iframe src=/game/the-labyrinth-of-gaze/build/web/index.html style="position:absolute;top:0;left:0;width:100%;height:100%;border:1px solid #ccc" title="Embedded Game" sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-fullscreen" loading=lazy></iframe></div><h2 id=building-your-pygame-game-for-the-web-using-the-handy-tool-pygbag>Building Your Pygame Game for the Web: Using the Handy Tool <code>pygbag</code></h2><p><code>pygbag</code> is a truly useful tool that packages Pygame games so they can run directly in a web browser. Let&rsquo;s use it to convert our game for the web first.</p><h3 id=1-first-prepare-your-project-with-uv>1. First, Prepare Your Project with <code>uv</code></h3><p>Here, we&rsquo;ll use <code>uv</code>, a recently popular Python package management tool. If you don&rsquo;t have <code>uv</code>, install it first. (If you&rsquo;re using another tool like <code>pip</code>, that&rsquo;s fine too).</p><ul><li>Installation command for uv (if needed, this is for Windows)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>powershell -ExecutionPolicy ByPass -c <span class=s2>&#34;irm https://astral.sh/uv/install.ps1 | iex&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Next, use <code>uv init</code> to create and initialize a folder for your game project.
<code>the-labyrinth-of-gaze</code> is the example game name used here, so please replace it with your own project name.</p><ul><li>Initialize the project with uv</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>uv init the-labyrinth-of-gaze
</span></span><span class=line><span class=cl><span class=k>cd</span> the-labyrinth-of-gaze
</span></span></code></pre></td></tr></table></div></div><p>Then, install the necessary libraries <code>pygbag</code> and <code>pygame</code>. With <code>uv</code>, it looks like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>uv add pygbag pygame
</span></span></code></pre></td></tr></table></div></div><p><em>(If you&rsquo;re not using <code>uv</code>, please install them according to your environment, perhaps using <code>pip install pygbag pygame</code>)</em></p><h3 id=2-now-lets-build-the-game>2. Now, Let&rsquo;s Build the Game</h3><p>Write your Pygame game code in the <code>main.py</code> file automatically created by <code>uv init</code>, or in your game&rsquo;s main script file.</p><p>The example game code used in this article is attached at the end.</p><p>Once ready, run the following command to build the game for the web.
Replace <code>main.py</code> with the filename of your game&rsquo;s main script.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>uv run pygbag --build .\main.py
</span></span></code></pre></td></tr></table></div></div><p>If this command succeeds, a <code>build/web</code> folder should be created in the current directory, containing the files needed to run the game in a web browser (<code>index.html</code>, <code>the-labyrinth-of-gaze.apk</code>, etc.).</p><p>Here&rsquo;s an example of the built files: <a class=link href=/game/the-labyrinth-of-gaze/build/web/index.html>/game/the-labyrinth-of-gaze/build/web/index.html</a></p><h2 id=embedding-the-game-in-your-hugo-blog>Embedding the Game in Your Hugo Blog</h2><p>Next, let&rsquo;s integrate the built game into your Hugo blog.
We&rsquo;ll use the <code>hugo-theme-stack</code> theme as an example, but the basic principles should apply to other Hugo themes as well.</p><h3 id=1-regarding-the-location-for-game-files>1. Regarding the Location for Game Files</h3><p>Hugo has a convenient folder called <code>static</code>. Files and folders placed here are copied directly to the root of your built site when the site is generated. We&rsquo;ll place the game files created by <code>pygbag</code> here.</p><p>Placement Steps (Example: Game name <code>the-labyrinth-of-gaze</code>):</p><ol><li>Inside the <code>static</code> folder at the root of your Hugo project, create a folder named <code>game</code> (create it if it doesn&rsquo;t exist).</li><li>Inside <code>static/game/</code>, create another folder for your game (e.g., <code>the-labyrinth-of-gaze</code>).</li><li>Copy the contents of the <code>build/web</code> folder generated by <code>pygbag</code> earlier into the <code>static/game/the-labyrinth-of-gaze/</code> folder you just created.<ul><li>Note: This is an important point! Do not copy the <code>build/web</code> folder itself, but rather copy the files within it (<code>index.html</code>, <code>the-labyrinth-of-gaze.apk</code>, etc.).</li></ul></li></ol><p>After placement, the folder structure should look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>(Your Hugo Project Folder)/
</span></span><span class=line><span class=cl>‚îî‚îÄ‚îÄ static/
</span></span><span class=line><span class=cl>    ‚îî‚îÄ‚îÄ game/
</span></span><span class=line><span class=cl>        ‚îî‚îÄ‚îÄ the-labyrinth-of-gaze/  &lt;-- Copy build results into this folder
</span></span><span class=line><span class=cl>            ‚îî‚îÄ‚îÄ build/
</span></span><span class=line><span class=cl>                ‚îî‚îÄ‚îÄ web/
</span></span><span class=line><span class=cl>                    ‚îú‚îÄ‚îÄ index.html
</span></span><span class=line><span class=cl>                    ‚îú‚îÄ‚îÄ the-labyrinth-of-gaze.apk
</span></span><span class=line><span class=cl>                    ‚îî‚îÄ‚îÄ (Other necessary files) ...
</span></span></code></pre></td></tr></table></div></div><p>Point: This setup allows you to access the game&rsquo;s <code>index.html</code> later from your website with a URL like <code>/game/the-labyrinth-of-gaze/build/web/index.html</code>.</p><h3 id=2-writing-iframe-tags-every-time-is-tedious-so-lets-create-a-hugo-shortcode>2. Writing <code>&lt;iframe></code> Tags Every Time is Tedious, So Let&rsquo;s Create a Hugo Shortcode</h3><p>Hugo has a useful feature called shortcodes, so let&rsquo;s use it to easily embed our game. Creating this will save you a lot of effort later.</p><p>Create a new file named <code>game-iframe.html</code> inside the <code>layouts/shortcodes/</code> folder of your Hugo project and paste the following code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{/* layouts/shortcodes/game-iframe.html */}}
</span></span><span class=line><span class=cl>{{/* Receive the game URL via &#39;src&#39; */}}
</span></span><span class=line><span class=cl>{{ $src := .Get &#34;src&#34; }}
</span></span><span class=line><span class=cl>{{/* Receive the aspect ratio via &#39;aspect-ratio&#39; (defaults to 75% = 4:3 if not specified) */}}
</span></span><span class=line><span class=cl>{{ $aspectRatio := .Get &#34;aspect-ratio&#34; | default &#34;75%&#34; }}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{/* Responsive iframe embedding styles */}}
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;position: relative; padding-bottom: {{ $aspectRatio }}; height: 0; overflow: hidden; max-width: 100%; height: auto;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>iframe</span>
</span></span><span class=line><span class=cl>    <span class=na>src</span><span class=o>=</span><span class=s>&#34;{{ $src }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>style</span><span class=o>=</span><span class=s>&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 1px solid #ccc;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>title</span><span class=o>=</span><span class=s>&#34;Embedded Game&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>sandbox</span><span class=o>=</span><span class=s>&#34;allow-scripts allow-same-origin allow-pointer-lock allow-fullscreen&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>loading</span><span class=o>=</span><span class=s>&#34;lazy&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>iframe</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Here&rsquo;s what this shortcode does:</p><ul><li>Accepts the URL of the game to embed via the <code>src</code> parameter.</li><li>Allows specifying the visual aspect ratio of the game screen via the <code>aspect-ratio</code> parameter (e.g., <code>75%</code> for 4:3, <code>56.25%</code> for 16:9). It defaults to <code>75%</code> (similar to 4:3) if not specified.</li><li>It embeds the content from the specified URL using an <code>&lt;iframe></code>.</li><li>Uses CSS to maintain the aspect ratio even when the screen size changes (making it responsive).</li><li>Applies some security restrictions to the iframe content using the <code>sandbox</code> attribute.</li><li>Uses <code>loading="lazy"</code> as a small optimization to defer loading the iframe until it&rsquo;s close to the viewport, potentially speeding up initial page load.</li></ul><h3 id=3-alright-setup-is-complete-lets-use-it-in-a-post>3. Alright, Setup is Complete! Let&rsquo;s Use it in a Post.</h3><p>Now you&rsquo;re ready! Open the Markdown file for the post where you want to feature the game and use the shortcode you just created.</p><p>For example, create a post file like <code>content/posts/my-pygame-game.md</code> and write something like this in the body:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>title: &#34;Publishing My Pygame Game: The Labyrinth of Gaze!&#34; # Post title
</span></span><span class=line><span class=cl>date: 2025-03-28T00:00:00+09:00
</span></span><span class=line><span class=cl>description: &#34;Published my maze game made with Pygame and pygbag. Play it easily in your browser!&#34; # Post description
</span></span><span class=line><span class=cl>slug: the-labyrinth-of-gaze-game # Post slug (part of the URL)
</span></span><span class=line><span class=cl>image: the-labyrinth-of-gaze.webp # Featured image
</span></span><span class=line><span class=cl>categories: [&#34;Games&#34;] # Category
</span></span><span class=line><span class=cl>tags: [&#34;Pygame&#34;, &#34;Indie Game&#34;, &#34;Puzzle&#34;] # Tags
</span></span><span class=line><span class=cl>draft: false
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I tried publishing my &#34;Labyrinth of Gaze&#34; game, made with Pygame, on the web!
</span></span><span class=line><span class=cl>Using <span class=sb>`pygbag`</span>, you can embed it in a blog like this. Convenient!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Feel free to play it right here in your browser.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{<span class=p>&lt;</span> <span class=nt>game-iframe</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/game/the-labyrinth-of-gaze/build/web/index.html&#34;</span> <span class=na>aspect-ratio</span><span class=o>=</span><span class=s>&#34;75%&#34;</span> <span class=p>&gt;</span>}}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Controls:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>*</span>   (Describe the game controls here)
</span></span><span class=line><span class=cl><span class=k>*</span>   Example: Arrow keys to move, Spacebar to jump, etc.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Game Description:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>(Describe the game&#39;s rules, objectives, highlights, etc., here)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I hope you enjoy it!
</span></span></code></pre></td></tr></table></div></div><p>The key points here are:</p><ul><li>Inside <code>{{&lt; ... >}}</code>, you write the name of the shortcode you created earlier: <code>game-iframe</code>.</li><li>For the <code>src</code> parameter, specify the absolute path on your website (starting with <code>/</code>) to the game&rsquo;s <code>index.html</code> file that you placed in the <code>static</code> folder.<ul><li>Example: If you placed it at <code>static/game/the-labyrinth-of-gaze/build/web/index.html</code>, you write <code>/game/the-labyrinth-of-gaze/build/web/index.html</code>.</li><li>Important: Be careful here, it&rsquo;s easy to get wrong! Make sure this path correctly points to where you placed your game files.</li></ul></li><li>Adjust the <code>aspect-ratio</code> to match your game&rsquo;s screen for better presentation (e.g., <code>56.25%</code> for 16:9).</li><li>Of course, you can add instructions, game descriptions, or any other content below the shortcode.</li></ul><p>After this, simply build your site with the <code>hugo</code> command and deploy it. The game should appear embedded in your post!</p><h2 id=summary>Summary</h2><p>In this article, we&rsquo;ve walked through the steps to use the convenient tool <code>pygbag</code> to convert a Pygame game to WebAssembly (WASM), place it in a Hugo blog&rsquo;s <code>static</code> folder, and create a Hugo shortcode for easy iframe embedding within posts.</p><p>Here are what I consider the main advantages of this method:</p><ul><li>No special server setup required! Being able to publish the game using only static files is very convenient.</li><li>Isn&rsquo;t it exciting to be able to easily add interactive games directly into your blog posts?</li><li>It increases the chances for more people to play the Pygame game you created!</li><li>Visitors will appreciate being able to play instantly without needing any browser plugins.</li></ul><p>If you&rsquo;ve made a game with Pygame and have been thinking, &ldquo;I&rsquo;d like to publish this on the web,&rdquo; I encourage you to try these steps.</p><p>Thank you for reading!</p><h2 id=source-code>Source Code</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span><span class=lnt>476
</span><span class=lnt>477
</span><span class=lnt>478
</span><span class=lnt>479
</span><span class=lnt>480
</span><span class=lnt>481
</span><span class=lnt>482
</span><span class=lnt>483
</span><span class=lnt>484
</span><span class=lnt>485
</span><span class=lnt>486
</span><span class=lnt>487
</span><span class=lnt>488
</span><span class=lnt>489
</span><span class=lnt>490
</span><span class=lnt>491
</span><span class=lnt>492
</span><span class=lnt>493
</span><span class=lnt>494
</span><span class=lnt>495
</span><span class=lnt>496
</span><span class=lnt>497
</span><span class=lnt>498
</span><span class=lnt>499
</span><span class=lnt>500
</span><span class=lnt>501
</span><span class=lnt>502
</span><span class=lnt>503
</span><span class=lnt>504
</span><span class=lnt>505
</span><span class=lnt>506
</span><span class=lnt>507
</span><span class=lnt>508
</span><span class=lnt>509
</span><span class=lnt>510
</span><span class=lnt>511
</span><span class=lnt>512
</span><span class=lnt>513
</span><span class=lnt>514
</span><span class=lnt>515
</span><span class=lnt>516
</span><span class=lnt>517
</span><span class=lnt>518
</span><span class=lnt>519
</span><span class=lnt>520
</span><span class=lnt>521
</span><span class=lnt>522
</span><span class=lnt>523
</span><span class=lnt>524
</span><span class=lnt>525
</span><span class=lnt>526
</span><span class=lnt>527
</span><span class=lnt>528
</span><span class=lnt>529
</span><span class=lnt>530
</span><span class=lnt>531
</span><span class=lnt>532
</span><span class=lnt>533
</span><span class=lnt>534
</span><span class=lnt>535
</span><span class=lnt>536
</span><span class=lnt>537
</span><span class=lnt>538
</span><span class=lnt>539
</span><span class=lnt>540
</span><span class=lnt>541
</span><span class=lnt>542
</span><span class=lnt>543
</span><span class=lnt>544
</span><span class=lnt>545
</span><span class=lnt>546
</span><span class=lnt>547
</span><span class=lnt>548
</span><span class=lnt>549
</span><span class=lnt>550
</span><span class=lnt>551
</span><span class=lnt>552
</span><span class=lnt>553
</span><span class=lnt>554
</span><span class=lnt>555
</span><span class=lnt>556
</span><span class=lnt>557
</span><span class=lnt>558
</span><span class=lnt>559
</span><span class=lnt>560
</span><span class=lnt>561
</span><span class=lnt>562
</span><span class=lnt>563
</span><span class=lnt>564
</span><span class=lnt>565
</span><span class=lnt>566
</span><span class=lnt>567
</span><span class=lnt>568
</span><span class=lnt>569
</span><span class=lnt>570
</span><span class=lnt>571
</span><span class=lnt>572
</span><span class=lnt>573
</span><span class=lnt>574
</span><span class=lnt>575
</span><span class=lnt>576
</span><span class=lnt>577
</span><span class=lnt>578
</span><span class=lnt>579
</span><span class=lnt>580
</span><span class=lnt>581
</span><span class=lnt>582
</span><span class=lnt>583
</span><span class=lnt>584
</span><span class=lnt>585
</span><span class=lnt>586
</span><span class=lnt>587
</span><span class=lnt>588
</span><span class=lnt>589
</span><span class=lnt>590
</span><span class=lnt>591
</span><span class=lnt>592
</span><span class=lnt>593
</span><span class=lnt>594
</span><span class=lnt>595
</span><span class=lnt>596
</span><span class=lnt>597
</span><span class=lnt>598
</span><span class=lnt>599
</span><span class=lnt>600
</span><span class=lnt>601
</span><span class=lnt>602
</span><span class=lnt>603
</span><span class=lnt>604
</span><span class=lnt>605
</span><span class=lnt>606
</span><span class=lnt>607
</span><span class=lnt>608
</span><span class=lnt>609
</span><span class=lnt>610
</span><span class=lnt>611
</span><span class=lnt>612
</span><span class=lnt>613
</span><span class=lnt>614
</span><span class=lnt>615
</span><span class=lnt>616
</span><span class=lnt>617
</span><span class=lnt>618
</span><span class=lnt>619
</span><span class=lnt>620
</span><span class=lnt>621
</span><span class=lnt>622
</span><span class=lnt>623
</span><span class=lnt>624
</span><span class=lnt>625
</span><span class=lnt>626
</span><span class=lnt>627
</span><span class=lnt>628
</span><span class=lnt>629
</span><span class=lnt>630
</span><span class=lnt>631
</span><span class=lnt>632
</span><span class=lnt>633
</span><span class=lnt>634
</span><span class=lnt>635
</span><span class=lnt>636
</span><span class=lnt>637
</span><span class=lnt>638
</span><span class=lnt>639
</span><span class=lnt>640
</span><span class=lnt>641
</span><span class=lnt>642
</span><span class=lnt>643
</span><span class=lnt>644
</span><span class=lnt>645
</span><span class=lnt>646
</span><span class=lnt>647
</span><span class=lnt>648
</span><span class=lnt>649
</span><span class=lnt>650
</span><span class=lnt>651
</span><span class=lnt>652
</span><span class=lnt>653
</span><span class=lnt>654
</span><span class=lnt>655
</span><span class=lnt>656
</span><span class=lnt>657
</span><span class=lnt>658
</span><span class=lnt>659
</span><span class=lnt>660
</span><span class=lnt>661
</span><span class=lnt>662
</span><span class=lnt>663
</span><span class=lnt>664
</span><span class=lnt>665
</span><span class=lnt>666
</span><span class=lnt>667
</span><span class=lnt>668
</span><span class=lnt>669
</span><span class=lnt>670
</span><span class=lnt>671
</span><span class=lnt>672
</span><span class=lnt>673
</span><span class=lnt>674
</span><span class=lnt>675
</span><span class=lnt>676
</span><span class=lnt>677
</span><span class=lnt>678
</span><span class=lnt>679
</span><span class=lnt>680
</span><span class=lnt>681
</span><span class=lnt>682
</span><span class=lnt>683
</span><span class=lnt>684
</span><span class=lnt>685
</span><span class=lnt>686
</span><span class=lnt>687
</span><span class=lnt>688
</span><span class=lnt>689
</span><span class=lnt>690
</span><span class=lnt>691
</span><span class=lnt>692
</span><span class=lnt>693
</span><span class=lnt>694
</span><span class=lnt>695
</span><span class=lnt>696
</span><span class=lnt>697
</span><span class=lnt>698
</span><span class=lnt>699
</span><span class=lnt>700
</span><span class=lnt>701
</span><span class=lnt>702
</span><span class=lnt>703
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Maze exploration animation using Pygame with A* algorithm (Auto-progress &amp; enhanced effects - modified version)</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pygame</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>heapq</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span> <span class=c1># Added for dt calculation (clock.tick is also okay)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Constants ---</span>
</span></span><span class=line><span class=cl><span class=c1># Grid settings</span>
</span></span><span class=line><span class=cl><span class=n>GRID_WIDTH</span> <span class=o>=</span> <span class=mi>31</span>
</span></span><span class=line><span class=cl><span class=n>GRID_HEIGHT</span> <span class=o>=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl><span class=n>CELL_SIZE</span> <span class=o>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=n>MARGIN</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Window size</span>
</span></span><span class=line><span class=cl><span class=n>WINDOW_WIDTH</span> <span class=o>=</span> <span class=n>GRID_WIDTH</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>)</span> <span class=o>+</span> <span class=n>MARGIN</span>
</span></span><span class=line><span class=cl><span class=n>WINDOW_HEIGHT</span> <span class=o>=</span> <span class=n>GRID_HEIGHT</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>)</span> <span class=o>+</span> <span class=n>MARGIN</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Colors (RGB) - Updated to a modern color scheme</span>
</span></span><span class=line><span class=cl><span class=n>WHITE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>245</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>245</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>BLACK</span> <span class=o>=</span> <span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>GREY</span> <span class=o>=</span> <span class=p>(</span><span class=mi>180</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>180</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>GREEN</span> <span class=o>=</span> <span class=p>(</span><span class=mi>76</span><span class=p>,</span> <span class=mi>187</span><span class=p>,</span> <span class=mi>23</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>RED</span> <span class=o>=</span> <span class=p>(</span><span class=mi>235</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>52</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>BLUE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>66</span><span class=p>,</span> <span class=mi>135</span><span class=p>,</span> <span class=mi>245</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>YELLOW</span> <span class=o>=</span> <span class=p>(</span><span class=mi>250</span><span class=p>,</span> <span class=mi>204</span><span class=p>,</span> <span class=mi>21</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>CYAN</span> <span class=o>=</span> <span class=p>(</span><span class=mi>28</span><span class=p>,</span> <span class=mi>186</span><span class=p>,</span> <span class=mi>210</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ORANGE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>126</span><span class=p>,</span> <span class=mi>28</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>LIGHT_ORANGE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>183</span><span class=p>,</span> <span class=mi>77</span><span class=p>)</span>  <span class=c1># For blinking</span>
</span></span><span class=line><span class=cl><span class=n>PATH_HIGHLIGHT</span> <span class=o>=</span> <span class=p>(</span><span class=mi>130</span><span class=p>,</span> <span class=mi>210</span><span class=p>,</span> <span class=mi>240</span><span class=p>)</span>  <span class=c1># Light blue (for path display animation)</span>
</span></span><span class=line><span class=cl><span class=n>PATH_HIGHLIGHT_PULSE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>180</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>250</span><span class=p>)</span>  <span class=c1># For pulse effect</span>
</span></span><span class=line><span class=cl><span class=n>GOAL_FLASH</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>  <span class=c1># For goal reached effect</span>
</span></span><span class=line><span class=cl><span class=n>HOVER_COLOR</span> <span class=o>=</span> <span class=p>(</span><span class=mi>220</span><span class=p>,</span> <span class=mi>220</span><span class=p>,</span> <span class=mi>220</span><span class=p>)</span>  <span class=c1># For hover effect</span>
</span></span><span class=line><span class=cl><span class=n>PURPLE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>180</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>240</span><span class=p>)</span>  <span class=c1># New color</span>
</span></span><span class=line><span class=cl><span class=n>PINK</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>180</span><span class=p>)</span>  <span class=c1># New color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Animation speed (Frames Per Second)</span>
</span></span><span class=line><span class=cl><span class=n>FPS</span> <span class=o>=</span> <span class=mi>60</span>
</span></span><span class=line><span class=cl><span class=c1># Wait time before auto-reset (seconds)</span>
</span></span><span class=line><span class=cl><span class=n>RESET_DELAY_SECONDS</span> <span class=o>=</span> <span class=mf>2.0</span>
</span></span><span class=line><span class=cl><span class=c1># Path highlight animation speed (cells per frame, smaller is slower)</span>
</span></span><span class=line><span class=cl><span class=n>PATH_HIGHLIGHT_SPEED</span> <span class=o>=</span> <span class=mf>0.3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Helper functions (unchanged) ---</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>heuristic</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>r1</span><span class=p>,</span> <span class=n>c1</span><span class=p>)</span> <span class=o>=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>r2</span><span class=p>,</span> <span class=n>c2</span><span class=p>)</span> <span class=o>=</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>abs</span><span class=p>(</span><span class=n>r1</span> <span class=o>-</span> <span class=n>r2</span><span class=p>)</span> <span class=o>+</span> <span class=nb>abs</span><span class=p>(</span><span class=n>c1</span> <span class=o>-</span> <span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_valid_neighbors</span><span class=p>(</span><span class=n>node</span><span class=p>,</span> <span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>neighbors</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span><span class=p>,</span> <span class=n>col</span> <span class=o>=</span> <span class=n>node</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>grid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cols</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>directions</span> <span class=o>=</span> <span class=p>[(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>dr</span><span class=p>,</span> <span class=n>dc</span> <span class=ow>in</span> <span class=n>directions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>nr</span><span class=p>,</span> <span class=n>nc</span> <span class=o>=</span> <span class=n>row</span> <span class=o>+</span> <span class=n>dr</span><span class=p>,</span> <span class=n>col</span> <span class=o>+</span> <span class=n>dc</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>nr</span> <span class=o>&lt;</span> <span class=n>rows</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>nc</span> <span class=o>&lt;</span> <span class=n>cols</span> <span class=ow>and</span> <span class=n>grid</span><span class=p>[</span><span class=n>nr</span><span class=p>][</span><span class=n>nc</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>neighbors</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>nr</span><span class=p>,</span> <span class=n>nc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>neighbors</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reconstruct_path</span><span class=p>(</span><span class=n>came_from</span><span class=p>,</span> <span class=n>current</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>current</span> <span class=ow>in</span> <span class=n>came_from</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>current</span> <span class=o>=</span> <span class=n>came_from</span><span class=p>[</span><span class=n>current</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=o>.</span><span class=n>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>path</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_maze</span><span class=p>(</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>grid</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>width</span><span class=p>)]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>height</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>start_r</span><span class=p>,</span> <span class=n>start_c</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randrange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>random</span><span class=o>.</span><span class=n>randrange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>grid</span><span class=p>[</span><span class=n>start_r</span><span class=p>][</span><span class=n>start_c</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>stack</span> <span class=o>=</span> <span class=p>[(</span><span class=n>start_r</span><span class=p>,</span> <span class=n>start_c</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>visited</span> <span class=o>=</span> <span class=p>{(</span><span class=n>start_r</span><span class=p>,</span> <span class=n>start_c</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>stack</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cr</span><span class=p>,</span> <span class=n>cc</span> <span class=o>=</span> <span class=n>stack</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>neighbors</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>dr</span><span class=p>,</span> <span class=n>dc</span> <span class=ow>in</span> <span class=p>[(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>),</span> <span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=n>nr</span><span class=p>,</span> <span class=n>nc</span> <span class=o>=</span> <span class=n>cr</span> <span class=o>+</span> <span class=n>dr</span><span class=p>,</span> <span class=n>cc</span> <span class=o>+</span> <span class=n>dc</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>nr</span> <span class=o>&lt;</span> <span class=n>height</span> <span class=o>-</span> <span class=mi>1</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>nc</span> <span class=o>&lt;</span> <span class=n>width</span> <span class=o>-</span> <span class=mi>1</span> <span class=ow>and</span> <span class=p>(</span><span class=n>nr</span><span class=p>,</span> <span class=n>nc</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>visited</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>neighbors</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>nr</span><span class=p>,</span> <span class=n>nc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>neighbors</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>nr</span><span class=p>,</span> <span class=n>nc</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>neighbors</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[(</span><span class=n>cr</span> <span class=o>+</span> <span class=n>nr</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>][(</span><span class=n>cc</span> <span class=o>+</span> <span class=n>nc</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>nr</span><span class=p>][</span><span class=n>nc</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>visited</span><span class=o>.</span><span class=n>add</span><span class=p>((</span><span class=n>nr</span><span class=p>,</span> <span class=n>nc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>stack</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>nr</span><span class=p>,</span> <span class=n>nc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>stack</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>passages</span> <span class=o>=</span> <span class=p>[(</span><span class=n>r</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>height</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>width</span><span class=p>)</span> <span class=k>if</span> <span class=n>grid</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>passages</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_node</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>width</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=k>else</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>end_node</span> <span class=o>=</span> <span class=p>(</span><span class=n>height</span> <span class=o>-</span> <span class=mi>2</span><span class=p>,</span> <span class=n>width</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span> <span class=k>if</span> <span class=n>height</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=ow>and</span> <span class=n>width</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=n>start_node</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>grid</span><span class=p>[</span><span class=n>start_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=n>start_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>start_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=n>start_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>grid</span><span class=p>[</span><span class=n>end_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=n>end_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>end_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=n>end_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>start_node</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>passages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>end_node</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>passages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>end_node</span> <span class=o>==</span> <span class=n>start_node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>end_node</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>passages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>grid</span><span class=p>,</span> <span class=n>start_node</span><span class=p>,</span> <span class=n>end_node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Particle class definition - Improved for more diverse effects</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Particle</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=n>particle_type</span><span class=o>=</span><span class=s2>&#34;normal&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>base_color</span> <span class=o>=</span> <span class=n>color</span> <span class=c1># Keep the original color</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color</span> <span class=o>=</span> <span class=n>color</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>=</span> <span class=n>particle_type</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;normal&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>speed</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>50</span> <span class=c1># Speed adjustment (dt-based)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;normal&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>*</span> <span class=mi>50</span> <span class=c1># Speed adjustment (dt-based)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>angle</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>math</span><span class=o>.</span><span class=n>pi</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;normal&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>2.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>pulse_rate</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>3.0</span><span class=p>,</span> <span class=mf>6.0</span><span class=p>)</span>  <span class=c1># For pulse effect</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span>  <span class=c1># For size variation</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fade_in_duration</span> <span class=o>=</span> <span class=mf>0.3</span> <span class=c1># Fade-in duration</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span> <span class=o>=</span> <span class=mf>0.7</span> <span class=c1># At what percentage of lifespan should fade-out start?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Number of vertices for star particles</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vertices</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span> <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;star&#34;</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># For trail particles</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>trail</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>trail_length</span> <span class=o>=</span> <span class=mi>5</span> <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;trail&#34;</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># For ripple effect</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;ripple&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>max_size</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>expand_speed</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>0.8</span><span class=p>,</span> <span class=mf>1.2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>30</span> <span class=c1># Speed adjustment (dt-based)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>speed</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Ripple does not move</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dt</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>math</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>angle</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>speed</span> <span class=o>*</span> <span class=n>dt</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>angle</span><span class=p>)</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>speed</span> <span class=o>*</span> <span class=n>dt</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>+=</span> <span class=n>dt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Update process according to particle type</span>
</span></span><span class=line><span class=cl>        <span class=n>size_decay_rate</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=o>/</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>))</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;normal&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>-</span> <span class=n>size_decay_rate</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;pulse&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>pulse</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>pulse_rate</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>            <span class=n>current_size_factor</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_size_factor</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=o>*</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=n>pulse</span> <span class=o>*</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=n>current_size_factor</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;fade_in&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_in_duration</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=o>*</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_in_duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=n>fade_out_duration</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span> <span class=o>/</span> <span class=n>fade_out_duration</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_size</span> <span class=c1># Max size after fade-in and before fade-out</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;trail&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>)</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>trail_length</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>-</span> <span class=n>size_decay_rate</span> <span class=o>*</span> <span class=n>dt</span> <span class=o>*</span> <span class=mf>0.5</span><span class=p>)</span> <span class=c1># Trail disappears a bit slower</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;ripple&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>expand_speed</span> <span class=o>*</span> <span class=n>dt</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;star&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>-</span> <span class=n>size_decay_rate</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> <span class=c1># default or rainbow etc.</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>-</span> <span class=n>size_decay_rate</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Color change (hue changes over time - rainbow type)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;rainbow&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>hue_shift</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span> <span class=o>%</span> <span class=mi>360</span>
</span></span><span class=line><span class=cl>            <span class=c1># HSV -&gt; RGB conversion (simplified version)</span>
</span></span><span class=line><span class=cl>            <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>hue_shift</span> <span class=o>/</span> <span class=mi>60</span><span class=p>)</span> <span class=o>%</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>            <span class=n>f</span> <span class=o>=</span> <span class=n>hue_shift</span> <span class=o>/</span> <span class=mi>60</span> <span class=o>-</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=c1># Value (brightness)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=c1># Saturation</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span> <span class=o>=</span> <span class=n>v</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>q</span> <span class=o>=</span> <span class=n>v</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>f</span> <span class=o>*</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>v</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>f</span><span class=p>)</span> <span class=o>*</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>v</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>q</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>p</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>t</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>p</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>t</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>5</span><span class=p>:</span> <span class=n>r_val</span><span class=p>,</span> <span class=n>g_val</span><span class=p>,</span> <span class=n>b_val</span> <span class=o>=</span> <span class=n>v</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>color</span> <span class=o>=</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>r_val</span><span class=o>*</span><span class=mi>255</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g_val</span><span class=o>*</span><span class=mi>255</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b_val</span><span class=o>*</span><span class=mi>255</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>surface</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># Do not draw if size is 0 or less</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Calculate transparency for fade-in/out effects</span>
</span></span><span class=line><span class=cl>        <span class=n>alpha</span> <span class=o>=</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;ripple&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Calculate transparency for ripple effect (gradually fades)</span>
</span></span><span class=line><span class=cl>            <span class=n>progress</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>alpha</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>progress</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.8</span><span class=p>)))</span> <span class=c1># Become more transparent towards the end</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;fade_in&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_in_duration</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>alpha</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_in_duration</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>fade_out_duration</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>fade_out_duration</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>alpha</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span> <span class=o>/</span> <span class=n>fade_out_duration</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>alpha</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Just in case</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>alpha</span> <span class=o>=</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> <span class=c1># Normal, Pulse, Star, Trail, Rainbow etc.</span>
</span></span><span class=line><span class=cl>            <span class=c1># Common fade-out process</span>
</span></span><span class=line><span class=cl>             <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>fade_out_duration</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>fade_out_duration</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>alpha</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=mi>255</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>fade_out_start_ratio</span><span class=p>)</span> <span class=o>/</span> <span class=n>fade_out_duration</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>alpha</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>             <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>alpha</span> <span class=o>=</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Validate and set color</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>current_color</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>color</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;rainbow&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>base_color</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>current_color</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>current_color</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>current_color</span><span class=p>[</span><span class=mi>0</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>                <span class=n>g</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>current_color</span><span class=p>[</span><span class=mi>1</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>                <span class=n>b</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>current_color</span><span class=p>[</span><span class=mi>2</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>                <span class=n>final_color</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>alpha</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>final_color</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=n>alpha</span><span class=p>)</span>  <span class=c1># Default color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Drawing according to particle type</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;ripple&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Ripple effect (draw outline)</span>
</span></span><span class=line><span class=cl>                <span class=n>line_width</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>max_size</span> <span class=o>/</span> <span class=mi>15</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>age</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>lifespan</span><span class=p>)))</span> <span class=c1># Outline gradually becomes thinner</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>:</span> <span class=c1># Minimum radius 1 or more</span>
</span></span><span class=line><span class=cl>                    <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>circle</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>final_color</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>)),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>),</span> <span class=n>width</span><span class=o>=</span><span class=n>line_width</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;star&#34;</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>vertices</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Star particle</span>
</span></span><span class=line><span class=cl>                <span class=n>points</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=n>outer_radius</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>                <span class=n>inner_radius</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>*</span> <span class=mf>0.4</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vertices</span> <span class=o>*</span> <span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>angle</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>vertices</span> <span class=o>*</span> <span class=n>i</span> <span class=o>-</span> <span class=n>math</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=mi>2</span> <span class=c1># Adjust so the vertex is at the top</span>
</span></span><span class=line><span class=cl>                    <span class=n>radius</span> <span class=o>=</span> <span class=n>outer_radius</span> <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>inner_radius</span>
</span></span><span class=line><span class=cl>                    <span class=n>x_p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>math</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>angle</span><span class=p>)</span> <span class=o>*</span> <span class=n>radius</span>
</span></span><span class=line><span class=cl>                    <span class=n>y_p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>angle</span><span class=p>)</span> <span class=o>*</span> <span class=n>radius</span>
</span></span><span class=line><span class=cl>                    <span class=n>points</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x_p</span><span class=p>,</span> <span class=n>y_p</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>points</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>:</span>  <span class=c1># At least 3 points required</span>
</span></span><span class=line><span class=cl>                    <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>polygon</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>final_color</span><span class=p>,</span> <span class=n>points</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;trail&#34;</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Trail particle</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>start_pos</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>end_pos</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=c1># Adjust trail alpha and width</span>
</span></span><span class=line><span class=cl>                    <span class=n>trail_alpha</span> <span class=o>=</span> <span class=n>alpha</span> <span class=o>*</span> <span class=p>((</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>))</span><span class=o>**</span><span class=mi>2</span> <span class=c1># Fainter towards the end</span>
</span></span><span class=line><span class=cl>                    <span class=n>trail_width</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>*</span> <span class=p>((</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>trail</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>                    <span class=n>trail_color_tuple</span> <span class=o>=</span> <span class=p>(</span><span class=n>final_color</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>final_color</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>final_color</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nb>int</span><span class=p>(</span><span class=n>trail_alpha</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>line</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>trail_color_tuple</span><span class=p>,</span> <span class=n>start_pos</span><span class=p>,</span> <span class=n>end_pos</span><span class=p>,</span> <span class=n>trail_width</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># Also draw the circle at the tip</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>circle</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>final_color</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>)),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Normal circular particles (Normal, Pulse, Fade_in, Rainbow)</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>circle</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>final_color</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>)),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=p>(</span><span class=ne>ValueError</span><span class=p>,</span> <span class=ne>TypeError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Use default color if an error occurs</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error drawing particle: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>, color=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>color</span><span class=si>}</span><span class=s2>, alpha=</span><span class=si>{</span><span class=n>alpha</span><span class=si>}</span><span class=s2>, size=</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>safe_color</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=n>alpha</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>circle</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=n>safe_color</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>)),</span> <span class=nb>int</span><span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>)))</span> <span class=c1># Ensure minimum size of 1</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>final_e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Final fallback drawing failed: </span><span class=si>{</span><span class=n>final_e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Pygame Initialization ---</span>
</span></span><span class=line><span class=cl><span class=n>pygame</span><span class=o>.</span><span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>screen</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>display</span><span class=o>.</span><span class=n>set_mode</span><span class=p>((</span><span class=n>WINDOW_WIDTH</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>pygame</span><span class=o>.</span><span class=n>display</span><span class=o>.</span><span class=n>set_caption</span><span class=p>(</span><span class=s2>&#34;A* Maze Solver Animation (Auto-Repeat, ESC: Quit)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>clock</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>Clock</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>font</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>font</span><span class=o>.</span><span class=n>Font</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- State Variables ---</span>
</span></span><span class=line><span class=cl><span class=n>grid</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>start_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=n>end_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=n>open_set_heap</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>open_set_map</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>closed_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>came_from</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>g_score</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>path</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>current_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=n>solving</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>maze_generated</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>particles</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># List for particles (ripples also integrated here)</span>
</span></span><span class=line><span class=cl><span class=c1># ripples = [] # Removed as it&#39;s no longer needed</span>
</span></span><span class=line><span class=cl><span class=n>node_pulses</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># For pulse effect during node search (currently might be unused?)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Auto-Reset Variables ---</span>
</span></span><span class=line><span class=cl><span class=n>reset_timer</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># Wait frame counter</span>
</span></span><span class=line><span class=cl><span class=n>RESET_DELAY_FRAMES</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>RESET_DELAY_SECONDS</span> <span class=o>*</span> <span class=n>FPS</span><span class=p>)</span>  <span class=c1># Convert seconds to number of frames</span>
</span></span><span class=line><span class=cl><span class=n>start_reset_timer_after_highlight</span> <span class=o>=</span> <span class=kc>False</span>  <span class=c1># Flag to start timer after highlighting is complete</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Path Highlight Animation Variables ---</span>
</span></span><span class=line><span class=cl><span class=n>path_highlight_index</span> <span class=o>=</span> <span class=mf>0.0</span>  <span class=c1># Use float to advance slowly</span>
</span></span><span class=line><span class=cl><span class=n>highlighting_path</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Goal Reached Effect ---</span>
</span></span><span class=line><span class=cl><span class=n>goal_reached_flash</span> <span class=o>=</span> <span class=kc>False</span>  <span class=c1># Is it the frame immediately after reaching the goal?</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Main Loop ---</span>
</span></span><span class=line><span class=cl><span class=n>running</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>frame_count</span> <span class=o>=</span> <span class=mi>0</span>  <span class=c1># For blinking animation</span>
</span></span><span class=line><span class=cl><span class=n>hover_cell</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># Currently hovered cell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>running</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># --- Delta Time Calculation ---</span>
</span></span><span class=line><span class=cl>    <span class=n>dt</span> <span class=o>=</span> <span class=n>clock</span><span class=o>.</span><span class=n>tick</span><span class=p>(</span><span class=n>FPS</span><span class=p>)</span> <span class=o>/</span> <span class=mf>1000.0</span> <span class=c1># Delta time in seconds (avoid division by zero)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>dt</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=n>dt</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>FPS</span> <span class=c1># Ensure minimum time step</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Event Handling ---</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>pygame</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=n>pygame</span><span class=o>.</span><span class=n>QUIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=n>pygame</span><span class=o>.</span><span class=n>KEYDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>key</span> <span class=o>==</span> <span class=n>pygame</span><span class=o>.</span><span class=n>K_ESCAPE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>running</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get hovered cell from mouse coordinates</span>
</span></span><span class=line><span class=cl>    <span class=n>mouse_pos</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>mouse</span><span class=o>.</span><span class=n>get_pos</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>mouse_col</span> <span class=o>=</span> <span class=n>mouse_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>//</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mouse_row</span> <span class=o>=</span> <span class=n>mouse_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>//</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>mouse_row</span> <span class=o>&lt;</span> <span class=n>GRID_HEIGHT</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>mouse_col</span> <span class=o>&lt;</span> <span class=n>GRID_WIDTH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hover_cell</span> <span class=o>=</span> <span class=p>(</span><span class=n>mouse_row</span><span class=p>,</span> <span class=n>mouse_col</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hover_cell</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- State Update ---</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>maze_generated</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Reset wait timer</span>
</span></span><span class=line><span class=cl>        <span class=n>reset_timer</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>start_reset_timer_after_highlight</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>highlighting_path</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>path_highlight_index</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>        <span class=n>goal_reached_flash</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>hover_cell</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>particles</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1># Clear existing particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;Generating new maze...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>screen</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>BLACK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>msg_render</span> <span class=o>=</span> <span class=n>font</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>WHITE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>screen</span><span class=o>.</span><span class=n>blit</span><span class=p>(</span><span class=n>msg_render</span><span class=p>,</span> <span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span> <span class=o>//</span> <span class=mi>2</span> <span class=o>-</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>pygame</span><span class=o>.</span><span class=n>display</span><span class=o>.</span><span class=n>flip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>grid</span><span class=p>,</span> <span class=n>start_node</span><span class=p>,</span> <span class=n>end_node</span> <span class=o>=</span> <span class=n>generate_maze</span><span class=p>(</span><span class=n>GRID_WIDTH</span><span class=p>,</span> <span class=n>GRID_HEIGHT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>open_set_heap</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>open_set_map</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>closed_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>came_from</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>current_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>g_score</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>c</span><span class=p>):</span> <span class=nb>float</span><span class=p>(</span><span class=s2>&#34;inf&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_HEIGHT</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_WIDTH</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>start_node</span><span class=p>:</span> <span class=c1># Confirm start_node is not None</span>
</span></span><span class=line><span class=cl>            <span class=n>g_score</span><span class=p>[</span><span class=n>start_node</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>h_start</span> <span class=o>=</span> <span class=n>heuristic</span><span class=p>(</span><span class=n>start_node</span><span class=p>,</span> <span class=n>end_node</span><span class=p>)</span> <span class=k>if</span> <span class=n>end_node</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=n>f_start</span> <span class=o>=</span> <span class=n>g_score</span><span class=p>[</span><span class=n>start_node</span><span class=p>]</span> <span class=o>+</span> <span class=n>h_start</span>
</span></span><span class=line><span class=cl>            <span class=n>heapq</span><span class=o>.</span><span class=n>heappush</span><span class=p>(</span><span class=n>open_set_heap</span><span class=p>,</span> <span class=p>(</span><span class=n>f_start</span><span class=p>,</span> <span class=n>h_start</span><span class=p>,</span> <span class=n>start_node</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>open_set_map</span><span class=p>[</span><span class=n>start_node</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>f_start</span><span class=p>,</span> <span class=n>h_start</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>maze_generated</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>solving</span> <span class=o>=</span> <span class=kc>True</span> <span class=k>if</span> <span class=n>start_node</span> <span class=ow>and</span> <span class=n>end_node</span> <span class=k>else</span> <span class=kc>False</span> <span class=c1># Do not solve if start/end nodes are missing</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;Solving...&#34;</span> <span class=k>if</span> <span class=n>solving</span> <span class=k>else</span> <span class=s2>&#34;Maze generated (No start/end?)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- A* Algorithm Step Execution ---</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>solving</span> <span class=ow>and</span> <span class=n>open_set_heap</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>current_f</span><span class=p>,</span> <span class=n>current_h</span><span class=p>,</span> <span class=n>current_node_popped</span> <span class=o>=</span> <span class=n>heapq</span><span class=o>.</span><span class=n>heappop</span><span class=p>(</span><span class=n>open_set_heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Skip if removed from open_set_map or a better path was found later</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_node_popped</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>open_set_map</span> <span class=ow>or</span> <span class=n>open_set_map</span><span class=p>[</span><span class=n>current_node_popped</span><span class=p>]</span> <span class=o>&gt;</span> <span class=p>(</span><span class=n>current_f</span><span class=p>,</span> <span class=n>current_h</span><span class=p>):</span>
</span></span><span class=line><span class=cl>             <span class=k>pass</span> <span class=c1># Ignore and proceed to the next loop</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Remove from open_set_map because it&#39;s being processed (may be re-added)</span>
</span></span><span class=line><span class=cl>            <span class=c1># Since it&#39;s targeted for processing when popped from heapq, del might be unnecessary. Duplication check is done in the if statement above.</span>
</span></span><span class=line><span class=cl>            <span class=c1># del open_set_map[current_node_popped] # Deletion here might be unnecessary</span>
</span></span><span class=line><span class=cl>            <span class=n>current_node</span> <span class=o>=</span> <span class=n>current_node_popped</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>current_node</span> <span class=o>==</span> <span class=n>end_node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>path</span> <span class=o>=</span> <span class=n>reconstruct_path</span><span class=p>(</span><span class=n>came_from</span><span class=p>,</span> <span class=n>current_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>solving</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;Goal Reached! Highlighting path...&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>current_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                <span class=n>highlighting_path</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=n>path_highlight_index</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>                <span class=n>goal_reached_flash</span> <span class=o>=</span> <span class=kc>True</span> <span class=c1># Effect generation flag ON</span>
</span></span><span class=line><span class=cl>                <span class=n>start_reset_timer_after_highlight</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>closed_set</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>current_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># Definitely remove from open_set_map (because it entered closed_set)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>current_node</span> <span class=ow>in</span> <span class=n>open_set_map</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>del</span> <span class=n>open_set_map</span><span class=p>[</span><span class=n>current_node</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># Add ripple effect to the node being explored</span>
</span></span><span class=line><span class=cl>                <span class=n>node_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>                <span class=n>node_y</span> <span class=o>=</span> <span class=p>(</span><span class=n>current_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># Generate ripple effect (using Particle class)</span>
</span></span><span class=line><span class=cl>                <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>node_x</span><span class=p>,</span> <span class=n>node_y</span><span class=p>,</span> <span class=n>YELLOW</span><span class=p>,</span> <span class=s2>&#34;ripple&#34;</span><span class=p>))</span> <span class=c1># Change color to YELLOW</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># Generate a small amount of small particles (during exploration)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mf>0.1</span><span class=p>:</span> <span class=c1># Slightly lower the probability</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span> <span class=c1># Reduce the number</span>
</span></span><span class=line><span class=cl>                        <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>YELLOW</span><span class=p>,</span> <span class=n>ORANGE</span><span class=p>])</span> <span class=c1># Match color to exploration color</span>
</span></span><span class=line><span class=cl>                        <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>node_x</span><span class=p>,</span> <span class=n>node_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;fade_in&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>neighbor</span> <span class=ow>in</span> <span class=n>get_valid_neighbors</span><span class=p>(</span><span class=n>current_node</span><span class=p>,</span> <span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>neighbor</span> <span class=ow>in</span> <span class=n>closed_set</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=n>tentative_g_score</span> <span class=o>=</span> <span class=n>g_score</span><span class=p>[</span><span class=n>current_node</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># Ignore if this path is not better than the existing one, or if a better path already exists in the open set</span>
</span></span><span class=line><span class=cl>                    <span class=c1># Note: open_set_map stores (f, h)</span>
</span></span><span class=line><span class=cl>                    <span class=n>neighbor_in_open</span> <span class=o>=</span> <span class=n>open_set_map</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>neighbor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>neighbor_in_open</span> <span class=ow>and</span> <span class=n>tentative_g_score</span> <span class=o>&gt;=</span> <span class=n>g_score</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>neighbor</span><span class=p>,</span> <span class=nb>float</span><span class=p>(</span><span class=s1>&#39;inf&#39;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                         <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># If a better path is found, or visiting for the first time</span>
</span></span><span class=line><span class=cl>                    <span class=n>came_from</span><span class=p>[</span><span class=n>neighbor</span><span class=p>]</span> <span class=o>=</span> <span class=n>current_node</span>
</span></span><span class=line><span class=cl>                    <span class=n>g_score</span><span class=p>[</span><span class=n>neighbor</span><span class=p>]</span> <span class=o>=</span> <span class=n>tentative_g_score</span>
</span></span><span class=line><span class=cl>                    <span class=n>h_neighbor</span> <span class=o>=</span> <span class=n>heuristic</span><span class=p>(</span><span class=n>neighbor</span><span class=p>,</span> <span class=n>end_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>f_neighbor</span> <span class=o>=</span> <span class=n>tentative_g_score</span> <span class=o>+</span> <span class=n>h_neighbor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># Add if not in open_set, update if present (heapq doesn&#39;t support direct update, so add a new element)</span>
</span></span><span class=line><span class=cl>                    <span class=n>heapq</span><span class=o>.</span><span class=n>heappush</span><span class=p>(</span><span class=n>open_set_heap</span><span class=p>,</span> <span class=p>(</span><span class=n>f_neighbor</span><span class=p>,</span> <span class=n>h_neighbor</span><span class=p>,</span> <span class=n>neighbor</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=n>open_set_map</span><span class=p>[</span><span class=n>neighbor</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>f_neighbor</span><span class=p>,</span> <span class=n>h_neighbor</span><span class=p>)</span> <span class=c1># Save f, h</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>solving</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>open_set_heap</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>solving</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;No path found! Resetting in </span><span class=si>{</span><span class=n>RESET_DELAY_SECONDS</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>s...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>current_node</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>reset_timer</span> <span class=o>=</span> <span class=n>RESET_DELAY_FRAMES</span>  <span class=c1># Start timer immediately on exploration failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Path Highlight Processing ---</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>highlighting_path</span> <span class=ow>and</span> <span class=n>path</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>path_highlight_index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>path_highlight_index</span> <span class=o>+=</span> <span class=n>PATH_HIGHLIGHT_SPEED</span> <span class=o>*</span> <span class=n>FPS</span> <span class=o>*</span> <span class=n>dt</span> <span class=c1># Adjust speed using dt</span>
</span></span><span class=line><span class=cl>            <span class=c1># Processing at the moment of completion</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>path_highlight_index</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>path_highlight_index</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>start_reset_timer_after_highlight</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>reset_timer</span> <span class=o>=</span> <span class=n>RESET_DELAY_FRAMES</span>
</span></span><span class=line><span class=cl>                    <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Path complete! Resetting in </span><span class=si>{</span><span class=n>RESET_DELAY_SECONDS</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>s...&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=n>start_reset_timer_after_highlight</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Auto-Reset Timer Processing ---</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>reset_timer</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>reset_timer</span> <span class=o>-=</span> <span class=mi>1</span> <span class=c1># Countdown on a frame basis</span>
</span></span><span class=line><span class=cl>        <span class=n>remaining_time</span> <span class=o>=</span> <span class=n>reset_timer</span> <span class=o>/</span> <span class=n>FPS</span> <span class=c1># Convert to seconds for display</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>solving</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>path</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;No path found! Resetting in </span><span class=si>{</span><span class=n>remaining_time</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>s...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=ow>not</span> <span class=n>solving</span> <span class=ow>and</span> <span class=n>path</span> <span class=ow>and</span> <span class=n>path_highlight_index</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Path complete! Resetting in </span><span class=si>{</span><span class=n>remaining_time</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>s...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>reset_timer</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>maze_generated</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Drawing Process ---</span>
</span></span><span class=line><span class=cl>    <span class=c1># Gradient background</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>WINDOW_HEIGHT</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>time_factor</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>frame_count</span> <span class=o>*</span> <span class=mf>0.005</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.2</span>
</span></span><span class=line><span class=cl>        <span class=n>r_base</span> <span class=o>=</span> <span class=mi>30</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=mi>10</span> <span class=o>*</span> <span class=n>time_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>g_base</span> <span class=o>=</span> <span class=mi>40</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=mi>15</span> <span class=o>*</span> <span class=n>time_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>b_base</span> <span class=o>=</span> <span class=mi>60</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=mi>20</span> <span class=o>*</span> <span class=n>time_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>gradient_factor</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>pi</span> <span class=o>*</span> <span class=n>y</span> <span class=o>/</span> <span class=n>WINDOW_HEIGHT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>r_base</span> <span class=o>+</span> <span class=p>(</span><span class=mi>50</span> <span class=o>-</span> <span class=n>r_base</span><span class=p>)</span> <span class=o>*</span> <span class=n>gradient_factor</span><span class=p>)</span> <span class=c1># Adjust to be slightly darker</span>
</span></span><span class=line><span class=cl>        <span class=n>g</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>g_base</span> <span class=o>+</span> <span class=p>(</span><span class=mi>70</span> <span class=o>-</span> <span class=n>g_base</span><span class=p>)</span> <span class=o>*</span> <span class=n>gradient_factor</span><span class=p>)</span> <span class=c1># Adjust to be slightly darker</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>b_base</span> <span class=o>+</span> <span class=p>(</span><span class=mi>90</span> <span class=o>-</span> <span class=n>b_base</span><span class=p>)</span> <span class=o>*</span> <span class=n>gradient_factor</span><span class=p>)</span> <span class=c1># Adjust to be slightly darker</span>
</span></span><span class=line><span class=cl>        <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>line</span><span class=p>(</span><span class=n>screen</span><span class=p>,</span> <span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>r</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>g</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>b</span><span class=p>)),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>WINDOW_WIDTH</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Improve cell texture (shadow and gloss) - This part can remain as is</span>
</span></span><span class=line><span class=cl>    <span class=n>shadow_surface</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>Surface</span><span class=p>((</span><span class=n>WINDOW_WIDTH</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span><span class=p>),</span> <span class=n>pygame</span><span class=o>.</span><span class=n>SRCALPHA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_HEIGHT</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_WIDTH</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>rect</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>Rect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>col</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>row</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>CELL_SIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>CELL_SIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>grid</span><span class=p>[</span><span class=n>row</span><span class=p>][</span><span class=n>col</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># Passage</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>shadow_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>30</span><span class=p>),</span> <span class=n>rect</span><span class=o>.</span><span class=n>inflate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=c1># Slightly lighter shadow</span>
</span></span><span class=line><span class=cl>                <span class=n>light_rect</span> <span class=o>=</span> <span class=n>rect</span><span class=o>.</span><span class=n>inflate</span><span class=p>(</span><span class=o>-</span><span class=mi>3</span><span class=p>,</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>move</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>shadow_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span> <span class=n>light_rect</span><span class=p>,</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=c1># Gloss is also slightly subdued</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span> <span class=c1># Wall</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>shadow_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span> <span class=n>rect</span><span class=o>.</span><span class=n>inflate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>shadow_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>30</span><span class=p>),</span> <span class=n>rect</span><span class=o>.</span><span class=n>inflate</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>),</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># Inner shadow</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>screen</span><span class=o>.</span><span class=n>blit</span><span class=p>(</span><span class=n>shadow_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Particle generation upon reaching the goal</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>goal_reached_flash</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>goal_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>end_node</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=n>goal_y</span> <span class=o>=</span> <span class=p>(</span><span class=n>end_node</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Generate diverse particle types</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>40</span><span class=p>):</span> <span class=c1># Increase normal particles</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>RED</span><span class=p>,</span> <span class=n>YELLOW</span><span class=p>,</span> <span class=n>ORANGE</span><span class=p>,</span> <span class=n>BLUE</span><span class=p>,</span> <span class=n>GREEN</span><span class=p>,</span> <span class=n>PURPLE</span><span class=p>,</span> <span class=n>PINK</span><span class=p>,</span> <span class=n>WHITE</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;normal&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>15</span><span class=p>):</span> <span class=c1># Increase star particles</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>YELLOW</span><span class=p>,</span> <span class=n>WHITE</span><span class=p>,</span> <span class=n>ORANGE</span><span class=p>,</span> <span class=n>CYAN</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;star&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span> <span class=c1># Pulse effect</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>CYAN</span><span class=p>,</span> <span class=n>PURPLE</span><span class=p>,</span> <span class=n>PINK</span><span class=p>,</span> <span class=n>BLUE</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;pulse&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span> <span class=c1># Trail particle</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>BLUE</span><span class=p>,</span> <span class=n>CYAN</span><span class=p>,</span> <span class=n>WHITE</span><span class=p>,</span> <span class=n>GREEN</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;trail&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span> <span class=c1># Rainbow particle</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>WHITE</span><span class=p>,</span> <span class=s2>&#34;rainbow&#34;</span><span class=p>))</span> <span class=c1># Initial color white is fine</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span> <span class=c1># Also generate ripple effect as Particle</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>([</span><span class=n>WHITE</span><span class=p>,</span> <span class=n>CYAN</span><span class=p>,</span> <span class=n>BLUE</span><span class=p>,</span> <span class=n>YELLOW</span><span class=p>])</span> <span class=c1># Ripple color</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>goal_x</span><span class=p>,</span> <span class=n>goal_y</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=s2>&#34;ripple&#34;</span><span class=p>))</span> <span class=c1># Generate with ripple type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>goal_reached_flash</span> <span class=o>=</span> <span class=kc>False</span> <span class=c1># ‚òÖ‚òÖ‚òÖ Reset the flag immediately after particle generation ‚òÖ‚òÖ‚òÖ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Cell drawing loop</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_HEIGHT</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>GRID_WIDTH</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>color</span> <span class=o>=</span> <span class=n>WHITE</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>grid</span><span class=p>[</span><span class=n>row</span><span class=p>][</span><span class=n>col</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>color</span> <span class=o>=</span> <span class=n>BLACK</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>node</span> <span class=o>=</span> <span class=p>(</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>is_path_node</span> <span class=o>=</span> <span class=kc>False</span> <span class=c1># Flag indicating whether it is a target for path highlighting</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Color setting according to cell state ---</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>closed_set</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Color for closed list (explored) - Slightly darker CYAN</span>
</span></span><span class=line><span class=cl>                 <span class=n>color</span> <span class=o>=</span> <span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>160</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># Node in open_set_map (exploration candidate) - Slightly darker YELLOW</span>
</span></span><span class=line><span class=cl>            <span class=c1># Even if the same node exists multiple times in heapq, open_set_map should contain the latest (f,h)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>open_set_map</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                 <span class=n>color</span> <span class=o>=</span> <span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=c1># Slightly darker YELLOW</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Path Highlighting ---</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>highlighting_path</span> <span class=ow>and</span> <span class=n>path</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_path_segment_index</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>path_highlight_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>path</span><span class=p>[:</span><span class=n>current_path_segment_index</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=n>is_path_node</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=n>pulse_factor</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>frame_count</span> <span class=o>*</span> <span class=mf>0.15</span> <span class=o>+</span> <span class=n>path</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>node</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.1</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=mf>0.5</span> <span class=c1># Phase shift based on node position</span>
</span></span><span class=line><span class=cl>                    <span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>PATH_HIGHLIGHT_PULSE</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>*</span> <span class=n>pulse_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>g</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>PATH_HIGHLIGHT_PULSE</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>*</span> <span class=n>pulse_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>b</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>PATH_HIGHLIGHT_PULSE</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>PATH_HIGHLIGHT</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>*</span> <span class=n>pulse_factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>color</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=c1># Effect for the leading node</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>current_path_segment_index</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>path</span><span class=p>)</span> <span class=ow>and</span> <span class=n>node</span> <span class=o>==</span> <span class=n>path</span><span class=p>[</span><span class=n>current_path_segment_index</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=p>(</span><span class=n>frame_count</span> <span class=o>//</span> <span class=mi>4</span><span class=p>)</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># Adjust blink speed</span>
</span></span><span class=line><span class=cl>                            <span class=n>color</span> <span class=o>=</span> <span class=n>PATH_HIGHLIGHT_PULSE</span>
</span></span><span class=line><span class=cl>                        <span class=c1># Particle at the tip (low probability)</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mf>0.15</span><span class=p>:</span> <span class=c1># Slightly increase probability</span>
</span></span><span class=line><span class=cl>                            <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>node</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>                            <span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=n>node</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>CELL_SIZE</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>))</span> <span class=o>+</span> <span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>                            <span class=n>particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Particle</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>PATH_HIGHLIGHT_PULSE</span><span class=p>,</span> <span class=s2>&#34;fade_in&#34;</span><span class=p>))</span> <span class=c1># Match the color</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Currently Explored Node ---</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>solving</span> <span class=ow>and</span> <span class=n>node</span> <span class=o>==</span> <span class=n>current_node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Blinking effect</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>frame_count</span> <span class=o>//</span> <span class=mi>8</span><span class=p>)</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span> <span class=c1># Adjust blink speed</span>
</span></span><span class=line><span class=cl>                    <span class=n>color</span> <span class=o>=</span> <span class=n>LIGHT_ORANGE</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>color</span> <span class=o>=</span> <span class=n>ORANGE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Start and Goal ---</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>node</span> <span class=o>==</span> <span class=n>start_node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>color</span> <span class=o>=</span> <span class=n>GREEN</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>node</span> <span class=o>==</span> <span class=n>end_node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Flash immediately after reaching the goal is not managed by the goal_reached_flash flag,</span>
</span></span><span class=line><span class=cl>                <span class=c1># other methods like making it brighter for the first few frames when highlighting_path becomes True can be considered</span>
</span></span><span class=line><span class=cl>                <span class=c1># Currently kept simple as RED</span>
</span></span><span class=line><span class=cl>                <span class=n>color</span> <span class=o>=</span> <span class=n>RED</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Cell Drawing ---</span>
</span></span><span class=line><span class=cl>            <span class=n>rect</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>Rect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>col</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>MARGIN</span> <span class=o>+</span> <span class=n>CELL_SIZE</span><span class=p>)</span> <span class=o>*</span> <span class=n>row</span> <span class=o>+</span> <span class=n>MARGIN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>CELL_SIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>CELL_SIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>screen</span><span class=p>,</span> <span class=n>color</span><span class=p>,</span> <span class=n>rect</span><span class=p>,</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Gloss and Hover Effect ---</span>
</span></span><span class=line><span class=cl>            <span class=n>is_floor_like</span> <span class=o>=</span> <span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>row</span><span class=p>][</span><span class=n>col</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>node</span> <span class=o>==</span> <span class=n>start_node</span> <span class=ow>or</span> <span class=n>node</span> <span class=o>==</span> <span class=n>end_node</span> <span class=ow>or</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>open_set_map</span> <span class=ow>or</span> <span class=n>node</span> <span class=ow>in</span> <span class=n>closed_set</span> <span class=ow>or</span> <span class=n>is_path_node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>is_floor_like</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Gloss</span>
</span></span><span class=line><span class=cl>                <span class=n>highlight_rect</span> <span class=o>=</span> <span class=n>rect</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>highlight_rect</span><span class=o>.</span><span class=n>height</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>CELL_SIZE</span> <span class=o>//</span> <span class=mi>4</span><span class=p>)</span> <span class=c1># Slightly smaller</span>
</span></span><span class=line><span class=cl>                <span class=n>highlight_color</span> <span class=o>=</span> <span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>40</span><span class=p>),</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>40</span><span class=p>),</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>40</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>screen</span><span class=p>,</span> <span class=n>highlight_color</span><span class=p>,</span> <span class=n>highlight_rect</span><span class=p>,</span> <span class=n>border_top_left_radius</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>border_top_right_radius</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># Hover</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>hover_cell</span> <span class=o>==</span> <span class=n>node</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>hover_rect</span> <span class=o>=</span> <span class=n>rect</span><span class=o>.</span><span class=n>inflate</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=c1># To avoid overlapping with the border</span>
</span></span><span class=line><span class=cl>                    <span class=n>hover_color</span> <span class=o>=</span> <span class=n>HOVER_COLOR</span> <span class=c1># Fixed color might be clearer</span>
</span></span><span class=line><span class=cl>                    <span class=c1># pygame.draw.rect(screen, hover_color, hover_rect, border_radius=2) # Fill</span>
</span></span><span class=line><span class=cl>                    <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>screen</span><span class=p>,</span> <span class=n>hover_color</span><span class=p>,</span> <span class=n>hover_rect</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=c1># Display with border</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># --- Border Line ---</span>
</span></span><span class=line><span class=cl>            <span class=n>border_color</span> <span class=o>=</span> <span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>50</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>50</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>color</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>50</span><span class=p>))</span> <span class=c1># Darker</span>
</span></span><span class=line><span class=cl>            <span class=n>pygame</span><span class=o>.</span><span class=n>draw</span><span class=o>.</span><span class=n>rect</span><span class=p>(</span><span class=n>screen</span><span class=p>,</span> <span class=n>border_color</span><span class=p>,</span> <span class=n>rect</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>border_radius</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>frame_count</span> <span class=o>+=</span> <span class=mi>1</span> <span class=c1># Increment frame_count here</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Particle Update and Drawing ---</span>
</span></span><span class=line><span class=cl>    <span class=n>active_particles</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>particles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>dt</span><span class=p>)</span> <span class=c1># Pass dt for update</span>
</span></span><span class=line><span class=cl>        <span class=c1># Survival check based on lifespan and size (or reaching max size for ripples)</span>
</span></span><span class=line><span class=cl>        <span class=n>is_alive</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>age</span> <span class=o>&lt;</span> <span class=n>p</span><span class=o>.</span><span class=n>lifespan</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>particle_type</span> <span class=o>==</span> <span class=s2>&#34;ripple&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Ripple disappears when lifespan ends (keeps moving even after reaching max_size)</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>             <span class=c1># Normal particles disappear when size becomes 0</span>
</span></span><span class=line><span class=cl>             <span class=n>is_alive</span> <span class=o>=</span> <span class=n>is_alive</span> <span class=ow>and</span> <span class=n>p</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>is_alive</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>active_particles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>particles</span> <span class=o>=</span> <span class=n>active_particles</span> <span class=c1># Keep only active particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Create a transparent Surface for particle drawing</span>
</span></span><span class=line><span class=cl>    <span class=c1># Using SRCALPHA ensures that the alpha value (transparency) of each particle is handled correctly</span>
</span></span><span class=line><span class=cl>    <span class=n>particle_surface</span> <span class=o>=</span> <span class=n>pygame</span><span class=o>.</span><span class=n>Surface</span><span class=p>((</span><span class=n>WINDOW_WIDTH</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span><span class=p>),</span> <span class=n>pygame</span><span class=o>.</span><span class=n>SRCALPHA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>particles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=n>draw</span><span class=p>(</span><span class=n>particle_surface</span><span class=p>)</span> <span class=c1># Draw on the transparent Surface</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Blit particle_surface onto the screen (where background and cells are already drawn)</span>
</span></span><span class=line><span class=cl>    <span class=n>screen</span><span class=o>.</span><span class=n>blit</span><span class=p>(</span><span class=n>particle_surface</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Message Display ---</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>text_color</span> <span class=o>=</span> <span class=n>WHITE</span>
</span></span><span class=line><span class=cl>        <span class=n>stroke_color</span> <span class=o>=</span> <span class=n>BLACK</span>
</span></span><span class=line><span class=cl>        <span class=n>msg_render</span> <span class=o>=</span> <span class=n>font</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>text_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Draw stroke</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>dx</span><span class=p>,</span> <span class=n>dy</span> <span class=ow>in</span> <span class=p>[(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=n>stroke_render</span> <span class=o>=</span> <span class=n>font</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=n>stroke_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>screen</span><span class=o>.</span><span class=n>blit</span><span class=p>(</span><span class=n>stroke_render</span><span class=p>,</span> <span class=p>(</span><span class=mi>10</span> <span class=o>+</span> <span class=n>dx</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span> <span class=o>-</span> <span class=mi>25</span> <span class=o>+</span> <span class=n>dy</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># Draw main text</span>
</span></span><span class=line><span class=cl>        <span class=n>screen</span><span class=o>.</span><span class=n>blit</span><span class=p>(</span><span class=n>msg_render</span><span class=p>,</span> <span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>WINDOW_HEIGHT</span> <span class=o>-</span> <span class=mi>25</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># --- Screen Update ---</span>
</span></span><span class=line><span class=cl>    <span class=n>pygame</span><span class=o>.</span><span class=n>display</span><span class=o>.</span><span class=n>flip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Resetting goal_reached_flash moved to immediately after particle generation</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># --- Cleanup Process ---</span>
</span></span><span class=line><span class=cl><span class=n>pygame</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/en/tags/python/>Python</a>
<a href=/en/tags/hugo/>Hugo</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/en/p/roblox-ts-template-for-modern-development/><div class=article-image><img src=/p/roblox-ts-template-for-modern-development/roblox-ts-template-for-modern-development.7af396fd154e0b9d345e3a313784cbbd_hu_f03d539097d9cc41.webp width=250 height=150 loading=lazy alt="Featured image of post A Modern Development Environment Template for Roblox (TypeScript) and VSCode" data-key=roblox-ts-template-for-modern-development data-hash="md5-evOW/RVOC500XjoxN4TLvQ=="></div><div class=article-details><h2 class=article-title>A Modern Development Environment Template for Roblox (TypeScript) and VSCode</h2></div></a></article><article class=has-image><a href=/en/p/roblox-luau-template-for-modern-development/><div class=article-image><img src=/p/roblox-luau-template-for-modern-development/roblox-luau-template-for-modern-development.7af396fd154e0b9d345e3a313784cbbd_hu_f03d539097d9cc41.webp width=250 height=150 loading=lazy alt="Featured image of post A Modern Development Environment Template for Roblox (Luau) and VSCode" data-key=roblox-luau-template-for-modern-development data-hash="md5-evOW/RVOC500XjoxN4TLvQ=="></div><div class=article-details><h2 class=article-title>A Modern Development Environment Template for Roblox (Luau) and VSCode</h2></div></a></article><article class=has-image><a href=/en/p/free-ai-models-create-threejs-game/><div class=article-image><img src=/p/free-ai-models-create-threejs-game/free-ai-models-create-threejs-game.e58640b9f9c13966bf9452e6e067ce58_hu_2de51dcfcd3d618.webp width=250 height=150 loading=lazy alt="Featured image of post Trying to Develop a Three.js Game Using the Latest Free AI Models Gemini 2.5 Pro and Trae Builder!" data-key=free-ai-models-create-threejs-game data-hash="md5-5YZAufnBOWa/lFLm4GfOWA=="></div><div class=article-details><h2 class=article-title>Trying to Develop a Three.js Game Using the Latest Free AI Models Gemini 2.5 Pro and Trae Builder!</h2></div></a></article><article class=has-image><a href=/en/p/rovo-dev-cli-guide-wsl2-blender/><div class=article-image><img src=/p/rovo-dev-cli-guide-wsl2-blender/rovo-dev-cli-guide-wsl2-blender.53c9331e345d1bef53c80de3491be75f_hu_8a9726256bf4bc98.webp width=250 height=150 loading=lazy alt="Featured image of post A Practical Guide to Rovo Dev CLI: How to Use It Comfortably with VSCode and WSL2" data-key=rovo-dev-cli-guide-wsl2-blender data-hash="md5-U8kzHjRdG+9TyA3jSRvnXw=="></div><div class=article-details><h2 class=article-title>A Practical Guide to Rovo Dev CLI: How to Use It Comfortably with VSCode and WSL2</h2></div></a></article><article class=has-image><a href=/en/p/build-llm-workflow-with-mastra/><div class=article-image><img src=/p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra.3b6c95df8c424b2929664540d3bcfa47_hu_ac8043f499719399.webp width=250 height=150 loading=lazy alt="Featured image of post Master LLM Workflows with mastra! From Grok-2 and think Tools to Generating Article Cloning Prompts" data-key=build-llm-workflow-with-mastra data-hash="md5-O2yV34xCSykpZkVA07z6Rw=="></div><div class=article-details><h2 class=article-title>Master LLM Workflows with mastra! From Grok-2 and think Tools to Generating Article Cloning Prompts</h2></div></a></article></div></div></aside><link rel=stylesheet href=/scss/partials/comments/disqusjs.min.css><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>let disqusjs;function loadDisqusJS(){disqusjs=new DisqusJS({shortname:"takoyakisoft",siteName:"TakoyakiSoft",apikey:"eL3QpmMQaI2omMQ6bzIOJQaX35h7aYJz4zB1kn3puW2xAkjuN7N5rx2kq0WNeOrC",api:"https://disqus.skk.moe/disqus/",admin:"takoyakisoft",adminLabel:"takoyaki"})}function lazyLoadDisqusJS(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqus.js",e.async=!1,document.body.appendChild(e),e.onload=()=>{loadDisqusJS(),window.addEventListener("onColorSchemeChange",e=>{disqusjs&&loadDisqusJS()})}}let runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;if(!isBot&&supportsIntersectionObserver){let e=new IntersectionObserver(function(t){t[0].isIntersecting&&(lazyLoadDisqusJS(),e.disconnect())});e.observe(document.getElementById("disqus_thread"))}else lazyLoadDisqusJS()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 TakoyakiSoft</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>