<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="æƒ³ä½¿ç”¨mastraåº“å’ŒTypeScriptï¼Œæ„å»ºä½¿ç”¨Grok-2æˆ–Gemini 2.5 Proçš„LLMå·¥ä½œæµå—ï¼Ÿä»å®‰è£…åˆ°å®ç°thinkå·¥å…·ï¼Œå†åˆ°è®©AIè‡ªèº«æ”¹è¿›æç¤ºçš„å¾ªç¯å¤„ç†ï¼Œæˆ‘ä»¬å°†ä»¥æ˜“äºç†è§£çš„æ–¹å¼è¯¦ç»†è§£è¯´å…·ä½“æ­¥éª¤ï¼"><title>ä½¿ç”¨mastraè‡ªç”±å®šåˆ¶LLMå·¥ä½œæµï¼ä»Grok-2å’Œthinkå·¥å…·åˆ°æ–‡ç« å…‹éš†æç¤ºç”Ÿæˆ</title><link rel=canonical href=https://takoyakisoft.com/zh-cn/p/build-llm-workflow-with-mastra/><link rel=stylesheet href=/scss/style.min.e2eb4d863e5f9e2d94c38679d645929c395fbab1ed23bbebd5526b205d5c473b.css><meta property='og:title' content="ä½¿ç”¨mastraè‡ªç”±å®šåˆ¶LLMå·¥ä½œæµï¼ä»Grok-2å’Œthinkå·¥å…·åˆ°æ–‡ç« å…‹éš†æç¤ºç”Ÿæˆ"><meta property='og:description' content="æƒ³ä½¿ç”¨mastraåº“å’ŒTypeScriptï¼Œæ„å»ºä½¿ç”¨Grok-2æˆ–Gemini 2.5 Proçš„LLMå·¥ä½œæµå—ï¼Ÿä»å®‰è£…åˆ°å®ç°thinkå·¥å…·ï¼Œå†åˆ°è®©AIè‡ªèº«æ”¹è¿›æç¤ºçš„å¾ªç¯å¤„ç†ï¼Œæˆ‘ä»¬å°†ä»¥æ˜“äºç†è§£çš„æ–¹å¼è¯¦ç»†è§£è¯´å…·ä½“æ­¥éª¤ï¼"><meta property='og:url' content='https://takoyakisoft.com/zh-cn/p/build-llm-workflow-with-mastra/'><meta property='og:site_name' content='TakoyakiSoft'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='mastra'><meta property='article:tag' content='TypeScript'><meta property='article:tag' content='Grok'><meta property='article:tag' content='Gemini'><meta property='article:published_time' content='2025-04-03T21:00:34+09:00'><meta property='article:modified_time' content='2025-04-03T21:00:34+09:00'><meta property='og:image' content='https://takoyakisoft.com/p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra.webp'><meta name=twitter:site content="@takoyakisoft"><meta name=twitter:creator content="@takoyakisoft"><meta name=twitter:title content="ä½¿ç”¨mastraè‡ªç”±å®šåˆ¶LLMå·¥ä½œæµï¼ä»Grok-2å’Œthinkå·¥å…·åˆ°æ–‡ç« å…‹éš†æç¤ºç”Ÿæˆ"><meta name=twitter:description content="æƒ³ä½¿ç”¨mastraåº“å’ŒTypeScriptï¼Œæ„å»ºä½¿ç”¨Grok-2æˆ–Gemini 2.5 Proçš„LLMå·¥ä½œæµå—ï¼Ÿä»å®‰è£…åˆ°å®ç°thinkå·¥å…·ï¼Œå†åˆ°è®©AIè‡ªèº«æ”¹è¿›æç¤ºçš„å¾ªç¯å¤„ç†ï¼Œæˆ‘ä»¬å°†ä»¥æ˜“äºç†è§£çš„æ–¹å¼è¯¦ç»†è§£è¯´å…·ä½“æ­¥éª¤ï¼"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://takoyakisoft.com/p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra.webp'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/zh-cn/><img src=/img/avatar_hu_f78e84f1474a9757.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ•¹ï¸</span></figure><div class=site-meta><h1 class=site-name><a href=/zh-cn>TakoyakiSoft</a></h1><h2 class=site-description>ä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è®²è§£å„ç§è½¯ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€‚</h2></div></header><ol class=menu-social><li><a href=https://bsky.app/profile/takoyakisoft.bsky.social target=_blank title=Bluesky rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bluesky"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.335 5.144C4.681 3.945 2 3.017 2 5.97c0 .59.35 4.953.556 5.661C3.269 14.094 5.686 14.381 8 14c-4.045.665-4.889 3.208-2.667 5.41C6.363 20.428 7.246 21 8 21c2 0 3.134-2.769 3.5-3.5.333-.667.5-1.167.5-1.5.0.333.167.833.5 1.5.366.731 1.5 3.5 3.5 3.5.754.0 1.637-.571 2.667-1.59C20.889 17.207 20.045 14.664 16 14c2.314.38 4.73.094 5.444-2.369.206-.708.556-5.072.556-5.661.0-2.953-2.68-2.025-4.335-.826C15.372 6.806 12.905 10.192 12 12c-.905-1.808-3.372-5.194-5.665-6.856z"/></svg></a></li><li><a href=https://github.com/takoyakisoft target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/takoyakisoft target=_blank title=X rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li><li><a href=https://www.youtube.com/@takoyaki-soft target=_blank title=YouTube rel=me><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M2 8a4 4 0 014-4h12a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M10 9l5 3-5 3z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/zh-cn/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/zh-cn/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>é¦–é¡µ</span></a></li><li><a href=/zh-cn/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>æ¡£æ¡ˆ</span></a></li><li><a href=/zh-cn/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>ç¤¾äº¤ç½‘ç»œé“¾æ¥</span></a></li><li><a href=/zh-cn/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-exclamation"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 7a4 4 0 108 0A4 4 0 008 7"/><path d="M6 21v-2a4 4 0 014-4h4c.348.0.686.045 1.008.128"/><path d="M19 16v3"/><path d="M19 22v.01"/></svg>
<span>å…³äºæœ¬ç«™</span></a></li><li><a href=/zh-cn/terms-of-service/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 3m0 2a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2H7a2 2 0 01-2-2z"/><path d="M9 7h6"/><path d="M9 11h6"/><path d="M9 15h4"/></svg>
<span>ä½¿ç”¨æ¡æ¬¾</span></a></li><li><a href=/zh-cn/privacy-policy/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-shield-lock"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3a12 12 0 008.5 3A12 12 0 0112 21 12 12 0 013.5 6 12 12 0 0012 3"/><path d="M12 11m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 12v2.5"/></svg>
<span>éšç§æ”¿ç­–</span></a></li><li><a href=/zh-cn/disclaimer/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-exclamation-circle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M12 9v4"/><path d="M12 16v.01"/></svg>
<span>å…è´£å£°æ˜</span></a></li><li><a href=/zh-cn/contact/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg>
<span>è”ç³»æˆ‘ä»¬</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://takoyakisoft.com/en/>English</option><option value=https://takoyakisoft.com/>æ—¥æœ¬èª</option><option value=https://takoyakisoft.com/zh-cn/ selected>ç®€ä½“ä¸­æ–‡</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å®‰è£…-mastra>å®‰è£… mastra</a></li><li><a href=#æŸ¥çœ‹è®¾ç½®>æŸ¥çœ‹è®¾ç½®</a></li><li><a href=#ç¡®è®¤è¿è¡Œæƒ…å†µ>ç¡®è®¤è¿è¡Œæƒ…å†µ</a></li><li><a href=#å®ç°thinkå·¥å…·>å®ç°â€œthinkå·¥å…·â€</a></li><li><a href=#thinkå·¥å…·çš„è¿è¡Œç¡®è®¤>thinkå·¥å…·çš„è¿è¡Œç¡®è®¤</a></li><li><a href=#å®ç°åˆ›å»ºæ–‡ç« å…‹éš†æç¤ºçš„å·¥ä½œæµ>å®ç°åˆ›å»ºæ–‡ç« å…‹éš†æç¤ºçš„å·¥ä½œæµ</a><ol><li><a href=#è¿™ä¸ªå·¥ä½œæµçš„ç›®æ ‡è®©-ai-å­¦ä¹ è‡ªå·±çš„æ–‡é£>è¿™ä¸ªå·¥ä½œæµçš„ç›®æ ‡ï¼šè®© AI å­¦ä¹ â€œè‡ªå·±çš„æ–‡é£â€</a></li><li><a href=#å‡†å¤‡æ·»åŠ è¯„ä¼°åº“å’Œæ³¨å†Œå·¥ä½œæµ>å‡†å¤‡ï¼šæ·»åŠ è¯„ä¼°åº“å’Œæ³¨å†Œå·¥ä½œæµ</a></li><li><a href=#aiæ”¹è¿›æç¤ºçš„æœºåˆ¶å¤„ç†æµç¨‹è§£è¯´>AIæ”¹è¿›æç¤ºçš„æœºåˆ¶ï¼šå¤„ç†æµç¨‹è§£è¯´</a></li><li><a href=#è¿è¡Œè¯•è¯•å·¥ä½œæµæ‰§è¡Œæ­¥éª¤>è¿è¡Œè¯•è¯•ï¼å·¥ä½œæµæ‰§è¡Œæ­¥éª¤</a></li><li><a href=#å®Œæ•´çš„å·¥ä½œæµä»£ç >å®Œæ•´çš„å·¥ä½œæµä»£ç </a></li><li><a href=#å®Œæˆæ¨¡ä»¿æŒ‡ç¤ºæç¤ºåŠå…¶ä½¿ç”¨æ–¹æ³•>å®Œæˆï¼â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€åŠå…¶ä½¿ç”¨æ–¹æ³•</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/zh-cn/p/build-llm-workflow-with-mastra/><img src=/p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra_hu_d1208c176298e21f.webp srcset="/p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra_hu_d1208c176298e21f.webp 800w, /p/build-llm-workflow-with-mastra/build-llm-workflow-with-mastra_hu_e2dcb93dee202248.webp 1600w" width=800 height=411 loading=lazy alt="Featured image of post ä½¿ç”¨mastraè‡ªç”±å®šåˆ¶LLMå·¥ä½œæµï¼ä»Grok-2å’Œthinkå·¥å…·åˆ°æ–‡ç« å…‹éš†æç¤ºç”Ÿæˆ"></a></div><div class=article-details><header class=article-category><a href=/zh-cn/categories/ai/>AI
</a><a href=/zh-cn/categories/%E7%BC%96%E7%A8%8B/>ç¼–ç¨‹</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/zh-cn/p/build-llm-workflow-with-mastra/>ä½¿ç”¨mastraè‡ªç”±å®šåˆ¶LLMå·¥ä½œæµï¼ä»Grok-2å’Œthinkå·¥å…·åˆ°æ–‡ç« å…‹éš†æç¤ºç”Ÿæˆ</a></h2><h3 class=article-subtitle>æƒ³ä½¿ç”¨mastraåº“å’ŒTypeScriptï¼Œæ„å»ºä½¿ç”¨Grok-2æˆ–Gemini 2.5 Proçš„LLMå·¥ä½œæµå—ï¼Ÿä»å®‰è£…åˆ°å®ç°thinkå·¥å…·ï¼Œå†åˆ°è®©AIè‡ªèº«æ”¹è¿›æç¤ºçš„å¾ªç¯å¤„ç†ï¼Œæˆ‘ä»¬å°†ä»¥æ˜“äºç†è§£çš„æ–¹å¼è¯¦ç»†è§£è¯´å…·ä½“æ­¥éª¤ï¼</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025å¹´04æœˆ03æ—¥</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 15 åˆ†é’Ÿ</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://takoyakisoft.com/en/p/build-llm-workflow-with-mastra/ class=link>English</a>
<a href=https://takoyakisoft.com/p/build-llm-workflow-with-mastra/ class=link>æ—¥æœ¬èª</a></div></footer></div></header><section class=article-content><p>å¤§å®¶å¥½ï¼è¿™æ¬¡ï¼Œæˆ‘å°†åˆ†äº«ä¸€ä¸‹ä½¿ç”¨åä¸ºmastraçš„åº“æ¥è¿è¡ŒGrok-2å’ŒGemini 2.5 Pro expç­‰LLMçš„ç»éªŒã€‚</p><p>mastraæ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒå…è®¸ä½ å†³å®šä½¿ç”¨å“ªä¸ªLLMæ¥åˆ›å»ºâ€œAIä»£ç†â€ï¼Œå¹¶æ„å»ºè¿™äº›ä»£ç†æŒ‰ä½•ç§é¡ºåºè¿è¡Œçš„â€œå·¥ä½œæµâ€ã€‚å¯¹æˆ‘ä¸ªäººæ¥è¯´ï¼Œå¯ä»¥ç”¨TypeScriptç¼–å†™è¿™ä¸€ç‚¹éå¸¸å¸å¼•äººï¼Œæˆ‘è®¤ä¸ºè¿™æ ·æˆ–è®¸å¯ä»¥å°†å…¶å»‰ä»·åœ°é›†æˆåˆ°Cloudflare Workersæˆ–Denoç­‰ç¯å¢ƒä¸­çš„WebæœåŠ¡ä¸­ã€‚</p><p>è™½ç„¶æœ‰åƒLangChainè¿™æ ·ç±»ä¼¼ä¸”è‘—åçš„åº“ï¼Œä½†mastraåœ¨éƒ¨ç½²ä¾¿åˆ©æ€§æ–¹é¢å¯èƒ½ç•¥æœ‰ä¼˜åŠ¿ã€‚å¦å¤–ï¼Œä¹‹å‰æˆ‘è¯•ç”¨è¿‡çš„åä¸ºDifyçš„å·¥å…·ï¼Œåœ¨å¤„ç†é‡å¤æ“ä½œï¼ˆå¾ªç¯ï¼‰æ–¹é¢æ„Ÿè§‰æœ‰äº›ä¸æ“…é•¿ï¼Œæ‰€ä»¥æˆ‘æƒ³è¯•è¯•mastraä¼šæ€ä¹ˆæ ·ï¼Œè¿™ä¹Ÿæ˜¯å°è¯•çš„èƒŒæ™¯ä¹‹ä¸€ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬é©¬ä¸Šå¼€å§‹è¯•è¯•å§ï¼</p><h2 id=å®‰è£…-mastra>å®‰è£… mastra</h2><p>è¿™æ¬¡æˆ‘å°†åœ¨Windows 11ä¸Šï¼Œä½¿ç”¨AIç¼–è¾‘å™¨â€œTraeâ€å’Œé«˜é€ŸåŒ…ç®¡ç†å™¨â€œpnpmâ€ã€‚</p><p>é¦–å…ˆï¼ŒæŒ‰ç…§mastraå®˜ç½‘ä¸Šçš„æ­¥éª¤åˆ›å»ºé¡¹ç›®ã€‚
ï¼ˆå‚è€ƒï¼š<a class=link href=https://mastra.ai/docs/getting-started/installation#create-a-new-project target=_blank rel=noopener>Create a New Project</a>ï¼‰</p><p>æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm create mastra@latest
</span></span></code></pre></td></tr></table></div></div><p>ä¼šé—®å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å›ç­”ä¸€ä¸‹ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/WindowsTerminal_UXtTR1rp9W.webp width=1127 height=1032 srcset="/p/build-llm-workflow-with-mastra/WindowsTerminal_UXtTR1rp9W_hu_e5736a7229396e4d.webp 480w, /p/build-llm-workflow-with-mastra/WindowsTerminal_UXtTR1rp9W_hu_7e216cf636dd59ff.webp 1024w" loading=lazy alt=mastraé¡¹ç›®åˆ›å»ºç•Œé¢ class=gallery-image data-flex-grow=109 data-flex-basis=262px></p><p>è¯¢é—®é¡¹ç›®åç§°ã€‚è¿™æ¬¡æˆ‘å‘½åä¸º <code>my-mastra-app</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—‡  What do you want to name your project?
</span></span><span class=line><span class=cl>â”‚  my-mastra-app
</span></span></code></pre></td></tr></table></div></div><p>è¯¢é—®æºæ–‡ä»¶çš„å­˜æ”¾ä½ç½®ã€‚é»˜è®¤çš„ <code>src/</code> å°±å¯ä»¥äº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—†  Where should we create the Mastra files? (default: src/)
</span></span><span class=line><span class=cl>â”‚  src/
</span></span></code></pre></td></tr></table></div></div><p>é€‰æ‹©éœ€è¦çš„ç»„ä»¶ã€‚Agentsï¼ˆä»£ç†ï¼‰ã€Workflowsï¼ˆå·¥ä½œæµï¼‰å’ŒToolsï¼ˆå·¥å…·ï¼‰ä¹‹åä¼šç”¨åˆ°ï¼Œæ‰€ä»¥é€‰ Yes å§ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—†  Choose components to install:
</span></span><span class=line><span class=cl>â”‚  â—¼ Agents
</span></span><span class=line><span class=cl>â”‚  â—¼ Workflows
</span></span><span class=line><span class=cl>â—‡  Add tools?
</span></span><span class=line><span class=cl>â”‚  Yes
</span></span></code></pre></td></tr></table></div></div><p>é€‰æ‹©é»˜è®¤ä½¿ç”¨çš„LLMæä¾›å•†ã€‚è¿™æ¬¡æˆ‘é€‰æ‹©äº†Googleï¼Œä½†è¿™ä¸ªä¹‹åå¯ä»¥è‡ªç”±æ›´æ”¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—‡  Select default provider:
</span></span><span class=line><span class=cl>â”‚  Google
</span></span></code></pre></td></tr></table></div></div><p>APIå¯†é’¥çš„è®¾ç½®ã€‚ä¹‹åä¼šåœ¨ <code>.env.development</code> æ–‡ä»¶ä¸­è®¾ç½®ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©è·³è¿‡ï¼ˆSkip for nowï¼‰æ²¡å…³ç³»ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—†  Enter your google API key?
</span></span><span class=line><span class=cl>â”‚  â— Skip for now (default)
</span></span></code></pre></td></tr></table></div></div><p>æ˜¯å¦æ·»åŠ ç¤ºä¾‹ï¼Œè¿™æ¬¡é€‰æ‹© Yesã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—‡  Add example
</span></span><span class=line><span class=cl>â”‚  Yes
</span></span></code></pre></td></tr></table></div></div><p>ä¸AI IDEçš„é›†æˆï¼Œè¿™æ¬¡ä¹Ÿè·³è¿‡äº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>â—‡  Make your AI IDE into a Mastra expert? (installs Mastra docs MCP server)
</span></span><span class=line><span class=cl>â”‚  Skip for now
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ ·é¡¹ç›®çš„æ¨¡æ¿å°±åˆ›å»ºå¥½äº†ï¼
ç§»åŠ¨åˆ°åˆ›å»ºçš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå®‰è£…æ‰€éœ€çš„åº“ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl><span class=k>cd</span> my-mastra-app
</span></span><span class=line><span class=cl>pnpm i
</span></span></code></pre></td></tr></table></div></div><p>å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚å¯ä»¥ç”¨Ctrl+Cåœæ­¢ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm run dev
</span></span></code></pre></td></tr></table></div></div><h2 id=æŸ¥çœ‹è®¾ç½®>æŸ¥çœ‹è®¾ç½®</h2><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªæ–‡ä»¶å§ã€‚</p><p>æŸ¥çœ‹ <code>package.json</code>ï¼Œå¯ä»¥çœ‹åˆ° <code>dependencies</code> é‡Œæœ‰ <code>@ai-sdk/google</code>ã€‚è¿™æ˜¯Vercelå…¬å¸æä¾›çš„åº“ï¼Œçœ‹èµ·æ¥ä¸ä»…æ”¯æŒGeminiï¼Œè¿˜æ”¯æŒDeepSeekã€Grokã€OpenRouterç­‰å…¶ä»–LLMæä¾›å•†ã€‚æ„Ÿè§‰å¾ˆæ–¹ä¾¿å‘¢ï¼
ï¼ˆå‚è€ƒï¼š<a class=link href=https://sdk.vercel.ai/providers/ai-sdk-providers target=_blank rel=noopener>AI SDK Providers</a>ï¼‰</p><p><code>scripts</code> é‡Œåªæœ‰ <code>dev</code>ã€‚ä¹Ÿè®¸å°†æ¥ä¼šæ·»åŠ ç”¨äºæ„å»ºæˆ–æµ‹è¯•çš„è„šæœ¬ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my-mastra-app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;main&#34;</span><span class=p>:</span> <span class=s2>&#34;index.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;mastra dev&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;keywords&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;license&#34;</span><span class=p>:</span> <span class=s2>&#34;ISC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@ai-sdk/google&#34;</span><span class=p>:</span> <span class=s2>&#34;^1.2.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@mastra/core&#34;</span><span class=p>:</span> <span class=s2>&#34;^0.7.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mastra&#34;</span><span class=p>:</span> <span class=s2>&#34;^0.4.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;zod&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.24.2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@types/node&#34;</span><span class=p>:</span> <span class=s2>&#34;^22.14.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tsx&#34;</span><span class=p>:</span> <span class=s2>&#34;^4.19.3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;typescript&#34;</span><span class=p>:</span> <span class=s2>&#34;^5.8.2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ¬¡æˆ‘ä»¬è¿˜æƒ³ä½¿ç”¨xAIçš„Grokï¼Œæ‰€ä»¥æ·»åŠ ç›¸åº”çš„åº“ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm add @ai-sdk/xai
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä¸å†éœ€è¦ï¼Œå¯ä»¥ç”¨ <code>pnpm remove @ai-sdk/xai</code> åˆ é™¤ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯APIå¯†é’¥çš„è®¾ç½®ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºåä¸º <code>.env.development</code> å’Œ <code>.env</code> çš„æ–‡ä»¶ï¼Œå¹¶åˆ†åˆ«å†™å…¥å„è‡ªçš„APIå¯†é’¥ã€‚ï¼ˆ<code>.env</code> ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œ<code>.env.development</code> ç”¨äºå¼€å‘ç¯å¢ƒï¼‰</p><p><code>.env.development</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>GOOGLE_GENERATIVE_AI_API_KEY</span><span class=o>=</span>your-google-api-key
</span></span><span class=line><span class=cl><span class=nv>XAI_API_KEY</span><span class=o>=</span>your-xai-api-key
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæƒ³æ›´æ”¹LLMæ¨¡å‹ï¼Œå¯ä»¥åœ¨å®šä¹‰ä»£ç†çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>src/mastra/agents/index.ts</code>ï¼‰æˆ–å·¥ä½œæµæ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>src/mastra/workflows/index.ts</code>ï¼‰ä¸­æŒ‡å®šã€‚</p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨Grok-2çš„æƒ…å†µæ˜¯è¿™æ ·çš„ã€‚</p><p><code>src/mastra/agents/index.ts</code> ç¤ºä¾‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>xai</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ai-sdk/xai&#39;</span><span class=p>;</span> <span class=c1>// å¯¼å…¥ xAI åº“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Agent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/agent&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>weatherTool</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../tools&#39;</span><span class=p>;</span> <span class=c1>// ä¹Ÿå¯¼å…¥è¦ä½¿ç”¨çš„å·¥å…·
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>weatherAgent</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Agent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Weather Agent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>instructions</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      You are a helpful weather assistant that provides accurate weather information.
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>      Your primary function is to help users get weather details for specific locations. When responding:
</span></span></span><span class=line><span class=cl><span class=sb>      - Always ask for a location if none is provided
</span></span></span><span class=line><span class=cl><span class=sb>      - If the location name isnâ€™t in English, please translate it
</span></span></span><span class=line><span class=cl><span class=sb>      - If giving a location with multiple parts (e.g. &#34;New York, NY&#34;), use the most relevant part (e.g. &#34;New York&#34;)
</span></span></span><span class=line><span class=cl><span class=sb>      - Include relevant details like humidity, wind conditions, and precipitation
</span></span></span><span class=line><span class=cl><span class=sb>      - Keep responses concise but informative
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>      Use the weatherTool to fetch current weather data.
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span>: <span class=kt>xai</span><span class=p>(</span><span class=s1>&#39;grok-2-latest&#39;</span><span class=p>),</span> <span class=c1>// åœ¨è¿™é‡ŒæŒ‡å®šæ¨¡å‹ï¼
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>tools</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weatherTool</span> <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨å·¥ä½œæµä¸­ä¹Ÿå¯ä»¥åŒæ ·æŒ‡å®šã€‚</p><p><code>src/mastra/workflows/index.ts</code> ç¤ºä¾‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>xai</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ai-sdk/xai&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Agent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/agent&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Step</span><span class=p>,</span> <span class=nx>Workflow</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/workflows&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>z</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;zod&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>llm</span> <span class=o>=</span> <span class=nx>xai</span><span class=p>(</span><span class=s1>&#39;grok-2-latest&#39;</span><span class=p>);</span> <span class=c1>// åœ¨è¿™é‡Œå®šä¹‰è¦ä½¿ç”¨çš„æ¨¡å‹
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ç¡®è®¤è¿è¡Œæƒ…å†µ>ç¡®è®¤è¿è¡Œæƒ…å†µ</h2><p>è®¾ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†å¯åŠ¨ä¸€æ¬¡å¼€å‘æœåŠ¡å™¨å§ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm run dev
</span></span></code></pre></td></tr></table></div></div><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a class=link href=http://localhost:4111/ target=_blank rel=noopener>http://localhost:4111/</a>ï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºmastraçš„ç•Œé¢ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_DllHdtTB78.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_DllHdtTB78_hu_523f3c38bccd80b5.webp 480w, /p/build-llm-workflow-with-mastra/Trae_DllHdtTB78_hu_b6bd473c52d66d37.webp 1024w" loading=lazy alt=weatherä»£ç†é€‰æ‹©ç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>å¯ä»¥é€‰æ‹©ä»£ç†ï¼Œç”¨èŠå¤©å½¢å¼è¯•è¯•å‘¢ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_8z5OEtWoym.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_8z5OEtWoym_hu_67c7256000ecd96a.webp 480w, /p/build-llm-workflow-with-mastra/Trae_8z5OEtWoym_hu_28642c119fbb0cc5.webp 1024w" loading=lazy alt=weatherä»£ç†çš„èŠå¤©ç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>ä½¿ç”¨Grok-2æ—¶ï¼Œæœ‰æ—¶ä¼šè¿”å›è‹±æ–‡å›ç­”ã€‚</p><h2 id=å®ç°thinkå·¥å…·>å®ç°â€œthinkå·¥å…·â€</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæœ‰ç‚¹æ„æ€çš„å·¥å…·ï¼Œå«åšâ€œthinkå·¥å…·â€ã€‚</p><p>è¿™æ˜¯Anthropicæ–‡ç« ä¸­ä»‹ç»çš„ä¸€ç§æŠ€å·§ï¼Œæ®è¯´åœ¨è®©LLMæ‰§è¡ŒæŸé¡¹æ“ä½œä¹‹å‰åŠ å…¥ä¸€ä¸ªâ€œæ€è€ƒâ€æ­¥éª¤ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚
ï¼ˆå‚è€ƒï¼š<a class=link href=https://www.anthropic.com/engineering/claude-think-tool target=_blank rel=noopener>The &ldquo;think&rdquo; tool: Enabling Claude to stop and think in complex tool use situations</a>ï¼‰</p><p>è¿™ä¸ªå·¥å…·æœ¬èº«å¹¶ä¸è·å–ä»»ä½•å¤–éƒ¨ä¿¡æ¯ï¼Œä»…ä»…æ˜¯æ¨¡ä»¿â€œæ€è€ƒâ€è¿™ä¸ªè¿‡ç¨‹ã€‚ä½†æ˜¯ï¼Œæ®è¯´è¿™æ ·èƒ½åœ¨éœ€è¦å¤æ‚æ¨ç†çš„æƒ…å†µä¸‹äº§ç”Ÿæ•ˆæœã€‚å¾ˆæœ‰è¶£å§ï¼</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ç”¨mastraæ¥åˆ›å»ºthinkå·¥å…·å§ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå®šä¹‰å·¥å…·çš„æ–‡ä»¶ã€‚</p><p><code>src/mastra/tools/thinkTool.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createTool</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/tools&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>z</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;zod&#39;</span><span class=p>;</span> <span class=c1>// ç”¨äºè¾“å…¥æ•°æ®éªŒè¯
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>thinkTool</span> <span class=o>=</span> <span class=nx>createTool</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;think&#39;</span><span class=p>,</span> <span class=c1>// å·¥å…·çš„ID
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>description</span><span class=o>:</span> <span class=s1>&#39;Use the tool to think about something. It will not obtain new information or change the database, but just append the thought to the log. Use it when complex reasoning or some cache memory is needed.&#39;</span><span class=p>,</span> <span class=c1>// å·¥å…·çš„æè¿°
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>inputSchema</span>: <span class=kt>z.object</span><span class=p>({</span> <span class=c1>// å·¥å…·æ¥æ”¶çš„è¾“å…¥çš„å®šä¹‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>thought</span>: <span class=kt>z.string</span><span class=p>().</span><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;A thought to think about.&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>outputSchema</span>: <span class=kt>z.object</span><span class=p>({}),</span> <span class=c1>// å·¥å…·è¾“å‡ºçš„æ•°æ®çš„å®šä¹‰ï¼ˆè¿™æ¬¡ä¸ºç©ºï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>execute</span>: <span class=kt>async</span> <span class=p>({</span> <span class=nx>context</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®é™…å¤„ç†ä»€ä¹ˆä¹Ÿä¸åš
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Thinking:&#39;</span><span class=p>,</span> <span class=nx>context</span><span class=p>.</span><span class=nx>thought</span><span class=p>);</span> <span class=c1>// æˆ–è®¸å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡ºæ€è€ƒå†…å®¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä½¿ç”¨è¿™ä¸ªthinkå·¥å…·çš„ä»£ç†ã€‚å…³é”®åœ¨äºé€šè¿‡æç¤ºæŒ‡ç¤ºä½•æ—¶åº”è¯¥ä½¿ç”¨thinkå·¥å…·å‘¢ã€‚</p><p><code>src/mastra/agents/thinkAgent.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Agent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/agent&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>thinkTool</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../tools/thinkTool&#39;</span><span class=p>;</span> <span class=c1>// å¯¼å…¥åˆ›å»ºçš„ thinkTool
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>xai</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ai-sdk/xai&#39;</span><span class=p>;</span> <span class=c1>// ä¹Ÿå¯¼å…¥è¦ä½¿ç”¨çš„LLMæ¨¡å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>thinkAgent</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Agent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Think Agent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>instructions</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    ## Using the think tool
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>    Before taking any action or responding to the user after receiving tool results, use the think tool as a scratchpad to:
</span></span></span><span class=line><span class=cl><span class=sb>    - List the specific rules that apply to the current request
</span></span></span><span class=line><span class=cl><span class=sb>    - Check if all required information is collected
</span></span></span><span class=line><span class=cl><span class=sb>    - Verify that the planned action complies with all policies
</span></span></span><span class=line><span class=cl><span class=sb>    - Iterate over tool results for correctness
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>    Here are some examples of what to iterate over inside the think tool:
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;think_tool_example_1&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    User wants to [specific scenario]
</span></span></span><span class=line><span class=cl><span class=sb>    - Need to verify: [key information]
</span></span></span><span class=line><span class=cl><span class=sb>    - Check relevant rules: [list rules]
</span></span></span><span class=line><span class=cl><span class=sb>    - Verify [important conditions]
</span></span></span><span class=line><span class=cl><span class=sb>    - Plan: [outline steps]
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/think_tool_example_1&gt;
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span>: <span class=kt>xai</span><span class=p>(</span><span class=s1>&#39;grok-2-latest&#39;</span><span class=p>),</span> <span class=c1>// è¿™é‡Œä¹Ÿè¯•è¯•ç”¨Grok-2å§
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>tools</span><span class=o>:</span> <span class=p>{</span> <span class=nx>thinkTool</span> <span class=p>}</span> <span class=c1>// æ³¨å†Œä¸ºè¯¥ä»£ç†ä½¿ç”¨çš„å·¥å…·
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€åï¼Œå°†åˆ›å»ºçš„å·¥å…·å’Œä»£ç†æ³¨å†Œåˆ°mastraã€‚</p><p><code>src/mastra/index.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Mastra</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/mastra&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createLogger</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/logger&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>weatherWorkflow</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./workflows&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>weatherAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./agents&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>thinkAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./agents/thinkAgent&#39;</span><span class=p>;</span> <span class=c1>// å¯¼å…¥åˆ›å»ºçš„ thinkAgent
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>mastra</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Mastra</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>workflows</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weatherWorkflow</span> <span class=p>},</span> <span class=c1>// ç°æœ‰çš„å·¥ä½œæµ
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>agents</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weatherAgent</span><span class=p>,</span> <span class=nx>thinkAgent</span> <span class=p>},</span> <span class=c1>// æ·»åŠ ä»£ç†
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>logger</span>: <span class=kt>createLogger</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Mastra&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>level</span><span class=o>:</span> <span class=s1>&#39;info&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ · think å·¥å…·çš„å®ç°å°±å®Œæˆäº†ï¼</p><h2 id=thinkå·¥å…·çš„è¿è¡Œç¡®è®¤>thinkå·¥å…·çš„è¿è¡Œç¡®è®¤</h2><p>å†æ¬¡å¯åŠ¨å¼€å‘æœåŠ¡å™¨æ¥ç¡®è®¤ä¸€ä¸‹å§ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm run dev
</span></span></code></pre></td></tr></table></div></div><p>è®¿é—® <a class=link href=http://localhost:4111/ target=_blank rel=noopener>http://localhost:4111/</a>ï¼Œè¿™æ¬¡è¯·é€‰æ‹©â€œThink Agentâ€ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_rklEm6XM9m.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_rklEm6XM9m_hu_942fbf387f6e2674.webp 480w, /p/build-llm-workflow-with-mastra/Trae_rklEm6XM9m_hu_9f44214b9918d7a4.webp 1024w" loading=lazy alt=thinkä»£ç†é€‰æ‹©ç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>å‘å‡ºä¸€äº›æŒ‡ç¤ºåï¼Œthink å·¥å…·åº”è¯¥ä¼šåœ¨åå°è¿è¡Œï¼Œç„¶åç»™å‡ºå›åº”ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_kSY1rEClJW.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_kSY1rEClJW_hu_f16017b4d425c115.webp 480w, /p/build-llm-workflow-with-mastra/Trae_kSY1rEClJW_hu_215aa6865a0bf9ed.webp 1024w" loading=lazy alt=thinkä»£ç†çš„èŠå¤©ç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ˜¯ç¨å¾®å¤æ‚çš„äº‹æƒ…ï¼Œä¹Ÿè®¸ä¹Ÿèƒ½æ›´å‡†ç¡®åœ°æ€è€ƒäº†ï¼</p><h2 id=å®ç°åˆ›å»ºæ–‡ç« å…‹éš†æç¤ºçš„å·¥ä½œæµ>å®ç°åˆ›å»ºæ–‡ç« å…‹éš†æç¤ºçš„å·¥ä½œæµ</h2><p>é‚£ä¹ˆï¼Œä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬æ¥æŒ‘æˆ˜ä¸€ä¸‹ç»“åˆmastraçš„å¾ªç¯åŠŸèƒ½å’Œè¯„ä¼°åŠŸèƒ½çš„ç¨å¾®è¿›é˜¶çš„å·¥ä½œæµå§ï¼</p><h3 id=è¿™ä¸ªå·¥ä½œæµçš„ç›®æ ‡è®©-ai-å­¦ä¹ è‡ªå·±çš„æ–‡é£>è¿™ä¸ªå·¥ä½œæµçš„ç›®æ ‡ï¼šè®© AI å­¦ä¹ â€œè‡ªå·±çš„æ–‡é£â€</h3><p>ä¸»é¢˜æ˜¯â€œè®©AIè‡ªå·±åˆ›å»ºæ¨¡ä»¿ç»™å®šæ–‡ç« å†™ä½œé£æ ¼çš„AIæç¤ºâ€ã€‚æ€»è§‰å¾—åƒæ˜¯è®©AIæ€è€ƒå¦‚ä½•ä½¿ç”¨AIï¼Œä¸è§‰å¾—è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„å°è¯•å—ï¼Ÿ</p><p>æœ€è¿‘ï¼Œä¹Ÿç»å¸¸å¬åˆ°â€œåˆ†ä¸æ¸…æ˜¯AIå†™çš„æ–‡ç« è¿˜æ˜¯äººå†™çš„æ–‡ç« ï¼â€è¿™æ ·çš„è¯å§ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå¹²è„†è®©AIå­¦ä¹ è‡ªå·±æ–‡ç« çš„ä¹ æƒ¯ï¼Œè®©å®ƒå¸®å¿™å†™åšå®¢æ–‡ç« çš„è‰ç¨¿ä¹‹ç±»çš„ï¼Œä¸å°±èƒ½å‡å°‘æ‰“å­—é‡ï¼Œå˜å¾—æ›´è½»æ¾äº†å—ï¼Ÿè¿™å°±æ˜¯æˆ‘å°è¯•åˆ›å»ºè¿™ä¸ªå·¥ä½œæµçš„å¥‘æœºã€‚</p><h3 id=å‡†å¤‡æ·»åŠ è¯„ä¼°åº“å’Œæ³¨å†Œå·¥ä½œæµ>å‡†å¤‡ï¼šæ·»åŠ è¯„ä¼°åº“å’Œæ³¨å†Œå·¥ä½œæµ</h3><p><strong>é¦–å…ˆæ˜¯å‡†å¤‡ï¼šæ·»åŠ è¯„ä¼°åº“</strong></p><p>åœ¨è¿™ä¸ªå·¥ä½œæµä¸­ï¼Œä¸ºäº†è®©å¦ä¸€ä¸ªAIè¯„ä¼°ç”Ÿæˆçš„æç¤ºçš„å¥½åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨mastraçš„è¯„ä¼°åº“ã€‚åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>pnpm add @mastra/evals
</span></span></code></pre></td></tr></table></div></div><p><strong>å°†å·¥ä½œæµæ³¨å†Œåˆ°mastra</strong></p><p>æ¥ä¸‹æ¥ï¼Œä¸ºäº†è®© mastra æœ¬ä½“è¯†åˆ«æˆ‘ä»¬å°†è¦åˆ›å»ºçš„å·¥ä½œæµ (<code>clonePromptGeneratorWorkflow</code>)ï¼Œæˆ‘ä»¬æ›´æ–°é…ç½®æ–‡ä»¶ (<code>src/mastra/index.ts</code>)ã€‚</p><p><code>src/mastra/index.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Mastra</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/mastra&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createLogger</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/logger&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>weatherWorkflow</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./workflows&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// â†“ å¯¼å…¥æ–°çš„å·¥ä½œæµ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>clonePromptGeneratorWorkflow</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./workflows/clonePromptGeneratorWorkflow&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>weatherAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./agents&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>thinkAgent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;./agents/thinkAgent&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>mastra</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Mastra</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// â†“ å°†æ–°çš„å·¥ä½œæµæ·»åŠ åˆ° workflows å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>workflows</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weatherWorkflow</span><span class=p>,</span> <span class=nx>clonePromptGeneratorWorkflow</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>agents</span><span class=o>:</span> <span class=p>{</span> <span class=nx>weatherAgent</span><span class=p>,</span> <span class=nx>thinkAgent</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>logger</span>: <span class=kt>createLogger</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Mastra&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>level</span><span class=o>:</span> <span class=s1>&#39;info&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ ·å‡†å¤‡å°±ç»ªäº†ï¼</p><h3 id=aiæ”¹è¿›æç¤ºçš„æœºåˆ¶å¤„ç†æµç¨‹è§£è¯´>AIæ”¹è¿›æç¤ºçš„æœºåˆ¶ï¼šå¤„ç†æµç¨‹è§£è¯´</h3><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®é™…ä¸Šæ˜¯ä»¥æ€æ ·çš„æµç¨‹è®©AIç”Ÿæˆå’Œæ”¹è¿›æç¤ºçš„å§ã€‚</p><ol><li><p>æç¤ºåˆ›å»ºAI (Prompt Creator Agent):
é¦–å…ˆï¼Œè®©å®ƒåˆ†æä½ å‡†å¤‡çš„ä½œä¸ºâ€œèŒƒæœ¬â€çš„æ–‡ç«  (<code>originalText</code>)ã€‚ç„¶åï¼Œæ•æ‰è¯¥æ–‡ç« ä½œè€…çš„ç‰¹å¾ï¼ˆäººæ ¼ã€æ–‡é£ã€å£å¤´ç¦…ç­‰ï¼‰ï¼Œåˆ›å»ºç”¨äºæŒ‡ç¤ºå…¶ä»–AIâ€œè¯·æ¨¡ä»¿è¿™ä¸ªäººæ¥å†™æ–‡ç« ï¼â€çš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€çš„åˆç‰ˆã€‚</p></li><li><p>ä¸»é¢˜æå–AI (Theme Abstractor Agent):
æ¥ä¸‹æ¥ï¼Œä»èŒƒæœ¬æ–‡ç« ä¸­å»é™¤å…·ä½“çš„ä¸“æœ‰åè¯ï¼ˆå¦‚ mastraã€Grok-2 ç­‰ï¼‰ï¼Œæå–å‡ºåƒâ€œä½¿ç”¨è½¯ä»¶å·¥å…·åŒ…åˆ›å»º AI å¤„ç†æµç¨‹çš„æ­¥éª¤â€è¿™æ ·çš„ä¸€èˆ¬æ€§çš„â€œæŠ½è±¡ä¸»é¢˜â€ã€‚è¿™æ˜¯ä¸ºäº†åœ¨æµ‹è¯•æ¨¡ä»¿ç¨‹åº¦æ—¶ï¼Œé¿å…ç”Ÿæˆä¸èŒƒæœ¬å®Œå…¨ç›¸åŒçš„å†…å®¹ã€‚</p></li><li><p>æ–‡ç« ç”ŸæˆAI (Text Generator Agent):
ä½¿ç”¨æ­¥éª¤1ä¸­åˆ›å»ºçš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€å’Œæ­¥éª¤2ä¸­æå–çš„â€œæŠ½è±¡ä¸»é¢˜â€ï¼Œè®©å®ƒå®é™…ç”Ÿæˆæ¨¡ä»¿æ–‡ç« ã€‚å¤§æ¦‚å°±æ˜¯â€œå…³äºâ€˜æŠ½è±¡ä¸»é¢˜â€™ï¼Œè¯·æŒ‰ç…§æ¨¡ä»¿æŒ‡ç¤ºæç¤ºæ¥å†™â€è¿™æ ·çš„æ„Ÿè§‰ã€‚</p></li><li><p>è¯„ä¼°AI (Authorship Similarity Judge/Metric):
ç»ˆäºåˆ°äº†è¯„ä¼°ç¯èŠ‚ã€‚è®©å®ƒæ¯”è¾ƒèŒƒæœ¬æ–‡ç« å’Œæ­¥éª¤3ä¸­ AI ç”Ÿæˆçš„æ¨¡ä»¿æ–‡ç« ï¼Œä»¥ 0.0ï¼ˆå®Œå…¨ä¸åƒï¼‰åˆ° 1.0ï¼ˆä¸€æ¨¡ä¸€æ ·ï¼ï¼‰çš„åˆ†æ•°æ¥è¯„å®šâ€œå†™ä½œé£æ ¼çš„ç›¸ä¼¼åº¦â€ã€‚åªçœ‹â€œå†™ä½œé£æ ¼â€ï¼Œæ¯”å¦‚è¯è¯­é€‰æ‹©ã€å¥å­é•¿åº¦ã€è¯­æ°”ã€æ ‡ç‚¹ç¬¦å·ç”¨æ³•ç­‰ï¼Œä¸é—®å†…å®¹çš„æ­£ç¡®æ€§ã€‚</p></li><li><p>å¾ªç¯åˆ¤æ–­ & åé¦ˆ:</p><ul><li>å¦‚æœè¯„ä¼°åˆ†æ•°è¶…è¿‡é¢„å…ˆè®¾å®šçš„é˜ˆå€¼ï¼ˆåœ¨ä»£ç ä¸­è®¾ä¸º <code>SIMILARITY_THRESHOLD = 0.7</code>ï¼‰ï¼Œåˆ™è§†ä¸ºâ€œåˆæ ¼ï¼â€ï¼Œå·¥ä½œæµç»“æŸï¼Œå¹¶è¾“å‡ºæˆåŠŸçš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€ã€‚</li><li>å¦‚æœåˆ†æ•°æœªè¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è¡¨ç¤ºâ€œè¿˜éœ€è¦åŠªåŠ›â€ã€‚è¯„ä¼° AI åˆ›å»ºæŒ‡å‡ºâ€œåˆ†æ•°ä¸ºä½•ä½ï¼ˆä¾‹å¦‚ï¼šæ ‡ç‚¹ç¬¦å·ç”¨æ³•æ›´ä¸åƒã€è¯­æ°”å¤ªç”Ÿç¡¬ç­‰ï¼‰â€çš„åé¦ˆï¼Œå¹¶å°†è¯¥åé¦ˆé™„åŠ åˆ°æ­¥éª¤1çš„æç¤ºåˆ›å»º AIï¼ŒæŒ‡ç¤ºâ€œè¯·å‚è€ƒè¿™ä¸ªåé¦ˆï¼Œåˆ›å»ºæ›´å¥½çš„æç¤ºï¼â€ï¼Œç„¶åè¿›è¡Œå¾ªç¯ã€‚</li></ul></li></ol><p>é€šè¿‡é‡å¤è¿™ä¸ªå¾ªç¯ï¼ŒAI åœ¨ä¸æ–­è¯•é”™ä¸­ï¼Œé€æ¸æ”¹è¿›ä¸ºèƒ½å¤Ÿç”Ÿæˆè¶Šæ¥è¶Šæ¥è¿‘èŒƒæœ¬å†™ä½œé£æ ¼çš„æ–‡ç« çš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€ï¼Œå°±æ˜¯è¿™æ ·çš„æœºåˆ¶ã€‚</p><p><strong>æç¤º:</strong></p><ul><li>æ¨¡å‹é€‰æ‹©: è¿™æ¬¡çš„ä»£ç ä¸­ä½¿ç”¨äº† <code>xai('grok-2-latest')</code>ï¼Œä½†å¦‚æœä½ å¯ä»¥é€šè¿‡ Google AI Studio ç­‰è®¿é—® <code>gemini('gemini-2.5-pro-exp-03-25')</code> è¿™æ ·çš„æ›´é«˜æ€§èƒ½æ¨¡å‹ï¼Œå°è¯•ä¸€ä¸‹ï¼Œæˆ–è®¸ä¸€æ¬¡å¾ªç¯å°±èƒ½å¾—åˆ°ç›¸å½“å¥½çš„ç»“æœï¼è¯·å°è¯•ä¿®æ”¹å„ä¸ª Agent æˆ– Metric çš„ <code>model: llm</code> éƒ¨åˆ†ã€‚</li><li>ç›¸ä¼¼åº¦åˆ†æ•°é˜ˆå€¼: <code>SIMILARITY_THRESHOLD</code> çš„å€¼ (0.7) æ˜¯è¯„ä¼°ä¸¥æ ¼ç¨‹åº¦çš„æ ‡å‡†ã€‚å¦‚æœå¾ªç¯è¿Ÿè¿Ÿä¸ç»“æŸï¼Œå¯ä»¥å°è¯•ç¨å¾®é™ä½ä¸€ç‚¹ï¼Œå¦‚æœæƒ³æé«˜ç²¾åº¦ï¼Œå¯ä»¥å°è¯•æé«˜ä¸€ç‚¹ï¼Œè¯·æ‰‹åŠ¨è°ƒæ•´è¯•è¯•çœ‹ã€‚</li></ul><h3 id=è¿è¡Œè¯•è¯•å·¥ä½œæµæ‰§è¡Œæ­¥éª¤>è¿è¡Œè¯•è¯•ï¼å·¥ä½œæµæ‰§è¡Œæ­¥éª¤</h3><p>åœ¨å¼€å‘æœåŠ¡å™¨ (<code>pnpm run dev</code>) å¯åŠ¨çš„çŠ¶æ€ä¸‹ï¼Œä»æµè§ˆå™¨è®¿é—® <a class=link href=http://localhost:4111/ target=_blank rel=noopener>http://localhost:4111/</a>ã€‚</p><p>ä»å·¦ä¾§èœå•ä¸­é€‰æ‹©â€œWorkflowsâ€ï¼Œç„¶åé€‰æ‹©è¿™æ¬¡åˆ›å»ºçš„ <code>clone-prompt-generator-workflow-with-eval</code>ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_xCr7Im1oMY.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_xCr7Im1oMY_hu_cb87b9a8b1a11d3f.webp 480w, /p/build-llm-workflow-with-mastra/Trae_xCr7Im1oMY_hu_7e30e7d904eb448f.webp 1024w" loading=lazy alt=å·¥ä½œæµé€‰æ‹©ç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>å³ä¾§åä¸ºâ€œRunâ€çš„é€‰é¡¹å¡ä¸­åº”è¯¥ä¼šæ˜¾ç¤ºä¸€ä¸ªåä¸º <code>OriginalText</code> çš„è¾“å…¥å­—æ®µã€‚åœ¨è¿™é‡Œï¼Œç²˜è´´ä½ æƒ³è¦ä½œä¸ºèŒƒæœ¬çš„æ–‡ç« ï¼ˆä¾‹å¦‚ï¼Œè¿‡å»å†™çš„åšå®¢æ–‡ç« çš„ä¸€éƒ¨åˆ†ç­‰ï¼‰ã€‚</p><p><img src=/p/build-llm-workflow-with-mastra/Trae_bRgLzPZ7ea.webp width=1920 height=1032 srcset="/p/build-llm-workflow-with-mastra/Trae_bRgLzPZ7ea_hu_8f82ae0720adb291.webp 480w, /p/build-llm-workflow-with-mastra/Trae_bRgLzPZ7ea_hu_79a54b40e6c919b0.webp 1024w" loading=lazy alt=å·¥ä½œæµæ‰§è¡Œç•Œé¢ class=gallery-image data-flex-grow=186 data-flex-basis=446px></p><p>ç²˜è´´æ–‡ç« åï¼Œç‚¹å‡»â€œSubmitâ€æŒ‰é’®ï¼</p><p>ä¹‹åï¼Œå°±è¯·å…³æ³¨ç»ˆç«¯ï¼ˆæˆ– VS Code ç­‰çš„ OUTPUT é¢æ¿ï¼‰ä¸­æ»šåŠ¨çš„æ—¥å¿—å§ã€‚æ¯æ¬¡å¾ªç¯æ—¶ï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºè¯„ä¼°åˆ†æ•°å’Œåé¦ˆã€‚</p><h3 id=å®Œæ•´çš„å·¥ä½œæµä»£ç >å®Œæ•´çš„å·¥ä½œæµä»£ç </h3><p>å®é™…è¿è¡Œçš„å·¥ä½œæµä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><code>src/mastra/workflows/clonePromptGeneratorWorkflow.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>xai</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@ai-sdk/xai&#39;</span><span class=p>;</span> <span class=c1>// æˆ–è€…ä½¿ç”¨ gemini, openai ç­‰
</span></span></span><span class=line><span class=cl><span class=c1>// import { gemini } from &#39;@ai-sdk/google&#39;; // ä½¿ç”¨ Gemini çš„ç¤ºä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>Agent</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/agent&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Step</span><span class=p>,</span> <span class=nx>Workflow</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/workflows&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>z</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;zod&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=kr>type</span> <span class=nx>LanguageModel</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/llm&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>MastraAgentJudge</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/evals/judge&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Metric</span><span class=p>,</span> <span class=kr>type</span> <span class=nx>MetricResult</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@mastra/core/eval&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- é…ç½® ---
</span></span></span><span class=line><span class=cl><span class=c1>// ä½¿ç”¨çš„LLMæ¨¡å‹ï¼ˆæ ¹æ®éœ€è¦æ›´æ”¹ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>llm</span> <span class=o>=</span> <span class=nx>xai</span><span class=p>(</span><span class=s1>&#39;grok-2-latest&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// const llm = gemini(&#39;gemini-2.5-pro-exp-03-25&#39;); // ä½¿ç”¨ Gemini 2.5 Pro Experimental çš„ç¤ºä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// åˆ¤å®šä¸ºåŒä¸€äººç‰©çš„ç›¸ä¼¼åº¦åˆ†æ•°é˜ˆå€¼ï¼ˆå¯è°ƒæ•´ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>SIMILARITY_THRESHOLD</span> <span class=o>=</span> <span class=mf>0.7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å­˜å‚¨å¯¹æç¤ºåˆ›å»º AI çš„åé¦ˆçš„å˜é‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>feedbackForPromptCreator</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å¾ªç¯è®¡æ•°å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>iteration</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- è¯„ä¼°ç›¸å…³å®šä¹‰ ---
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * ç”Ÿæˆä¼ é€’ç»™è¯„ä¼° AI çš„æç¤ºçš„å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>generateSimilarityPrompt</span> <span class=o>=</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>originalText</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>generatedText</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>originalText</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>generatedText</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})</span> <span class=o>=&gt;</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>æ‚¨æ˜¯ä¸€ä½æ¯”è¾ƒåˆ†ææ–‡ç« å†™ä½œé£æ ¼çš„ä¸“å®¶ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>è¯·æ¯”è¾ƒç»™å®šçš„â€œèŒƒæœ¬æ–‡ç« â€å’Œâ€œAIç”Ÿæˆçš„æ–‡ç« â€ï¼Œè¯„ä¼°ä¸¤è€…æ˜¯å¦**çœ‹èµ·æ¥åƒæ˜¯åŒä¸€ä¸ªäººå†™çš„**ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>**è¯„ä¼°æ ‡å‡†ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>è¯·å…³æ³¨ä»¥ä¸‹è¦ç´ ï¼Œåˆ¤æ–­ç»¼åˆçš„å†™ä½œé£æ ¼ç›¸ä¼¼åº¦ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>*   **æ–‡é£ï¼š** ç¬¬ä¸€äººç§°ã€è¯­æ°”ï¼ˆæ•¬è¯­ã€éšä¾¿ç­‰ï¼‰ã€å¥å°¾ï¼ˆï½ã§ã™ã€ï½ã ã€ï½ã‚ˆã­ç­‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=sb>*   **è¯è¯­é€‰æ‹©ï¼š** åçˆ±çš„è¯è¯­ã€è¡¨è¾¾æ–¹å¼ã€ä¸“ä¸šæœ¯è¯­ä½¿ç”¨é¢‘ç‡
</span></span></span><span class=line><span class=cl><span class=sb>*   **æ–‡ç« ç»“æ„ï¼š** å¥å­é•¿åº¦ã€æ®µè½ä½¿ç”¨ã€è¿æ¥è¯ä½¿ç”¨ã€é€»è¾‘å±•å¼€
</span></span></span><span class=line><span class=cl><span class=sb>*   **èŠ‚å¥æ„Ÿï¼š** æ ‡ç‚¹ç¬¦å·ä½¿ç”¨ã€åè¯ç»“å°¾ï¼ˆä½“è¨€æ­¢ã‚ï¼‰é¢‘ç‡
</span></span></span><span class=line><span class=cl><span class=sb>*   **æƒ…æ„Ÿè¡¨è¾¾ï¼š** ç§¯æ/æ¶ˆæã€æƒ…æ„Ÿè¡¨è¾¾æ–¹å¼ã€æœ‰æ— å¹½é»˜æ„Ÿ
</span></span></span><span class=line><span class=cl><span class=sb>*   **ä¹ æƒ¯ï¼š** ç‰¹å¾æ€§çš„è¡¨è¾¾æ–¹å¼ã€é”™åˆ«å­—å€¾å‘ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>**é‡è¦ï¼š** è¯·ä»…è¯„ä¼°**å†™ä½œé£æ ¼**çš„ç›¸ä¼¼æ€§ï¼Œè€Œéä¸»é¢˜æˆ–å†…å®¹çš„æ­£ç¡®æ€§ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>**è¾“å‡ºæ ¼å¼ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>è¯·æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¿”å›è¯„ä¼°ç»“æœã€‚
</span></span></span><span class=line><span class=cl><span class=sb>*   \`similarityScore\`: è¯·ç”¨ 0.0ï¼ˆå®Œå…¨ä¸åƒï¼‰åˆ° 1.0ï¼ˆçœ‹èµ·æ¥å®Œå…¨æ˜¯åŒä¸€ä¸ªäººï¼‰ä¹‹é—´çš„**æ•°å€¼**æ¥è¯„ä¼°å†™ä½œé£æ ¼çš„ç›¸ä¼¼åº¦ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>*   \`reason\`: è¯·ç®€è¦è¯´æ˜å¾—åˆ°è¯¥åˆ†æ•°çš„åŸå› ã€‚ç‰¹åˆ«æ˜¯åˆ†æ•°è¾ƒä½æ—¶ï¼Œè¯·æŒ‡å‡ºæ‚¨è§‰å¾—å“ªäº›åœ°æ–¹ä¸åŒã€‚
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`json
</span></span></span><span class=line><span class=cl><span class=sb>{
</span></span></span><span class=line><span class=cl><span class=sb>  &#34;similarityScore&#34;: number (0.0 ~ 1.0),
</span></span></span><span class=line><span class=cl><span class=sb>  &#34;reason&#34;: string
</span></span></span><span class=line><span class=cl><span class=sb>}
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>---
</span></span></span><span class=line><span class=cl><span class=sb>**èŒƒæœ¬æ–‡ç« ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`
</span></span></span><span class=line><span class=cl><span class=sb></span><span class=si>${</span><span class=nx>originalText</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>---
</span></span></span><span class=line><span class=cl><span class=sb>**AIç”Ÿæˆçš„æ–‡ç« ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`
</span></span></span><span class=line><span class=cl><span class=sb></span><span class=si>${</span><span class=nx>generatedText</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>\`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>---
</span></span></span><span class=line><span class=cl><span class=sb>è¯·æŒ‰ç…§ä¸Šè¿°æ ¼å¼ï¼Œä»¥JSONè¾“å‡ºè¯„ä¼°ç»“æœã€‚
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * è¯„ä¼°ç»“æœçš„ç±»å‹å®šä¹‰ï¼ˆzod æ¨¡å¼ï¼‰
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>SimilarityEvaluationSchema</span> <span class=o>=</span> <span class=nx>z</span><span class=p>.</span><span class=kt>object</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>similarityScore</span>: <span class=kt>z.number</span><span class=p>().</span><span class=nx>min</span><span class=p>(</span><span class=mi>0</span><span class=p>).</span><span class=nx>max</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;å†™ä½œé£æ ¼ç›¸ä¼¼åº¦åˆ†æ•°ï¼ˆ0.0 åˆ° 1.0ï¼‰&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>reason</span>: <span class=kt>z.string</span><span class=p>().</span><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;è¯„ä¼°ç†ç”±&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>SimilarityEvaluation</span> <span class=o>=</span> <span class=nx>z</span><span class=p>.</span><span class=k>infer</span><span class=p>&lt;</span><span class=nt>typeof</span> <span class=na>SimilarityEvaluationSchema</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * è¯„ä¼°å™¨ï¼ˆJudgeï¼‰ç±»
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AuthorshipSimilarityJudge</span> <span class=kr>extends</span> <span class=nx>MastraAgentJudge</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span><span class=nx>model</span>: <span class=kt>LanguageModel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;Authorship Similarity Judge&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;æ‚¨æ˜¯ä¸€ä½æ¯”è¾ƒåˆ†ææ–‡ç« å†™ä½œé£æ ¼çš„ä¸“å®¶ã€‚è¯·æŒ‰ç…§ç»™å®šçš„æŒ‡ç¤ºï¼Œè¯„ä¼°ä¸¤ç¯‡æ–‡ç« çš„ç›¸ä¼¼åº¦ã€‚&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>model</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>evaluate</span><span class=p>(</span><span class=nx>originalText</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>generatedText</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>SimilarityEvaluation</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>prompt</span> <span class=o>=</span> <span class=nx>generateSimilarityPrompt</span><span class=p>({</span> <span class=nx>originalText</span><span class=p>,</span> <span class=nx>generatedText</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=c1>// å¦‚æœæ¨¡å‹æ”¯æŒJSONæ¨¡å¼æˆ–æ¨¡å¼å¼ºåˆ¶ï¼Œåˆ™åŠ ä»¥åˆ©ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>agent</span><span class=p>.</span><span class=nx>generate</span><span class=p>(</span><span class=nx>prompt</span><span class=p>,</span> <span class=p>{</span> <span class=nx>output</span>: <span class=kt>SimilarityEvaluationSchema</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>result</span><span class=p>.</span><span class=kt>object</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;è§£æè¯„ä¼°ç»“æœå¤±è´¥ã€‚å°†è¿”å›åŸå§‹æ–‡æœ¬ã€‚&#34;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å›é€€ï¼šå¦‚æœJSONè§£æå¤±è´¥ï¼Œåˆ™è§†ä¸ºåˆ†æ•°0ç­‰
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>fallbackResult</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>agent</span><span class=p>.</span><span class=nx>generate</span><span class=p>(</span><span class=nx>prompt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span> <span class=nx>similarityScore</span>: <span class=kt>0.0</span><span class=p>,</span> <span class=nx>reason</span><span class=o>:</span> <span class=sb>`è¯„ä¼° AI çš„è¾“å‡ºæ ¼å¼ä¸æ­£ç¡®ï¼š </span><span class=si>${</span><span class=nx>fallbackResult</span><span class=p>.</span><span class=nx>text</span><span class=si>}</span><span class=sb>`</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * è¯„ä¼°æŒ‡æ ‡ï¼ˆMetricï¼‰ç±»
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>AuthorshipSimilarityMetricResult</span> <span class=kr>extends</span> <span class=nx>MetricResult</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span>: <span class=kt>SimilarityEvaluation</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AuthorshipSimilarityMetric</span> <span class=kr>extends</span> <span class=nx>Metric</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>private</span> <span class=nx>judge</span>: <span class=kt>AuthorshipSimilarityJudge</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>constructor</span><span class=p>(</span><span class=nx>model</span>: <span class=kt>LanguageModel</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>judge</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AuthorshipSimilarityJudge</span><span class=p>(</span><span class=nx>model</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>measure</span><span class=p>(</span><span class=nx>originalText</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>generatedText</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>AuthorshipSimilarityMetricResult</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>evaluationResult</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>judge</span><span class=p>.</span><span class=nx>evaluate</span><span class=p>(</span><span class=nx>originalText</span><span class=p>,</span> <span class=nx>generatedText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span>: <span class=kt>evaluationResult.similarityScore</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>info</span>: <span class=kt>evaluationResult</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- å·¥ä½œæµå®šä¹‰ ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>clonePromptGeneratorWorkflow</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Workflow</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;clone-prompt-generator-workflow-with-eval&#34;</span><span class=p>,</span> <span class=c1>// å·¥ä½œæµåç§°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>triggerSchema</span>: <span class=kt>z.object</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>originalText</span>: <span class=kt>z.string</span><span class=p>().</span><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;The original text written by the user to be cloned.&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- æ­¥éª¤1ï¼šç”Ÿæˆæ¨¡ä»¿æŒ‡ç¤ºæç¤º ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>generateClonePromptStep</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Step</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=s2>&#34;generate-clone-prompt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>execute</span>: <span class=kt>async</span> <span class=p>({</span> <span class=nx>context</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>promptCreatorAgent</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Agent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Prompt Creator Agent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>instructions</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>            # æŒ‡ç¤ºï¼šè¯·åˆ›å»ºæœ€ä½³çš„â€œæ¨¡ä»¿æ–‡ç« ç”Ÿæˆæç¤ºâ€
</span></span></span><span class=line><span class=cl><span class=sb>            æ‚¨æ˜¯æç¤ºå·¥ç¨‹å¸ˆ AIã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åˆ†æç»™å®šçš„**ã€ä¾‹æ–‡ã€‘**ï¼Œå‡†ç¡®æŠŠæ¡å…¶ä½œè€…çš„**ç‰¹å¾ï¼ˆäººæ ¼ã€æ–‡é£ã€ä¹ æƒ¯ï¼‰**ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**é€šç”¨çš„æŒ‡ç¤ºæç¤º**ï¼Œä»¥ä¾¿è®©å…¶ä»– AI æ¨¡ä»¿è¯¥ä½œè€…ç”Ÿæˆ**åƒäººä¸€æ ·è‡ªç„¶çš„**æ–‡ç« ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>            ï¼ˆçœç•¥... æç¤ºçš„æ¡ä»¶å’Œæ€è€ƒè¿‡ç¨‹ä¸å˜ï¼‰
</span></span></span><span class=line><span class=cl><span class=sb>            **é‚£ä¹ˆï¼Œç»¼åˆä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼Œè¯·åˆ›å»ºæœ€ä½³çš„â€œæ¨¡ä»¿æ–‡ç« ç”Ÿæˆæç¤ºâ€ã€‚**
</span></span></span><span class=line><span class=cl><span class=sb>            </span><span class=si>${</span><span class=nx>feedbackForPromptCreator</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>            `</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>model</span>: <span class=kt>llm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>originalText</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>triggerData</span><span class=p>.</span><span class=nx>originalText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[generate-clone-prompt] å¼€å§‹ç”Ÿæˆæç¤ºã€‚&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>promptCreatorAgent</span><span class=p>.</span><span class=nx>generate</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>        ã€ä¾‹æ–‡ã€‘:
</span></span></span><span class=line><span class=cl><span class=sb>        </span><span class=si>${</span><span class=nx>originalText</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>        `</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[generate-clone-prompt] æç¤ºç”Ÿæˆå®Œæˆã€‚&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`</span><span class=si>${</span><span class=nx>result</span><span class=p>.</span><span class=nx>text</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- æœ€åæ­¥éª¤ï¼šè¾“å‡ºæˆåŠŸçš„æç¤º ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>outputFinalPromptStep</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Step</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=s2>&#34;output-final-prompt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>execute</span>: <span class=kt>async</span> <span class=p>({</span> <span class=nx>context</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>finalPrompt</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>getStepResult</span><span class=p>(</span><span class=nx>generateClonePromptStep</span><span class=p>)</span> <span class=kr>as</span> <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;--------------------------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;å·¥ä½œæµå·²å®Œæˆï¼&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;æˆåŠŸçš„æ¨¡ä»¿æŒ‡ç¤ºæç¤ºï¼š&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;--------------------------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>finalPrompt</span><span class=p>);</span> <span class=c1>// åœ¨æ§åˆ¶å°è¾“å‡ºæœ€ç»ˆæç¤º
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;--------------------------------------------------&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>finalPrompt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- å·¥ä½œæµç»„è£… ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>clonePromptGeneratorWorkflow</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>step</span><span class=p>(</span><span class=nx>generateClonePromptStep</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>until</span><span class=p>(</span><span class=kr>async</span> <span class=p>({</span> <span class=nx>context</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span> <span class=c1>// æ¥æ”¶ iteration
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>iteration</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=err>\</span><span class=sb>n--- å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb> å¼€å§‹ ---`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 1. è·å–ç”Ÿæˆçš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>generatedClonePrompt</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>getStepResult</span><span class=p>(</span><span class=nx>generateClonePromptStep</span><span class=p>)</span> <span class=kr>as</span> <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>originalText</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>triggerData</span><span class=p>.</span><span class=nx>originalText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 2. æŠ½è±¡åŒ– originalText çš„ä¸»é¢˜
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>themeAbstractorAgent</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Agent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Theme Abstractor Agent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>instructions</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>            è¯·åˆ†æç»™å®šæ–‡ç« çš„ä¸»è¦ä¸»é¢˜æˆ–è¯é¢˜ï¼Œ**é¿å…ä½¿ç”¨å…·ä½“çš„ä¸“æœ‰åè¯ã€äº§å“åã€æŠ€æœ¯åã€æœåŠ¡åç­‰**ï¼Œç”¨æ›´é€šç”¨ã€æŠ½è±¡çš„è¯­è¨€æ¥è¡¨è¾¾ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>            è¾“å‡ºè¯·ä»…åŒ…å«è¯¥æŠ½è±¡ä¸»é¢˜çš„è¯´æ˜æ–‡å­—ï¼Œä¸è¦åŒ…å«å…¶ä»–è§£è¯´æˆ–å‰è¨€ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>            ç¤ºä¾‹ï¼šï¼ˆçœç•¥...ï¼‰
</span></span></span><span class=line><span class=cl><span class=sb>          `</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>model</span>: <span class=kt>llm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] æ­£åœ¨ä» originalText æŠ½è±¡åŒ–ä¸»é¢˜...`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>abstractionResult</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>themeAbstractorAgent</span><span class=p>.</span><span class=nx>generate</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>        è¯·æŠ½è±¡åŒ–ä»¥ä¸‹æ–‡ç« çš„ä¸»é¢˜ï¼š</span><span class=err>\</span><span class=sb>n---</span><span class=err>\</span><span class=sb>n</span><span class=si>${</span><span class=nx>originalText</span><span class=si>}</span><span class=err>\</span><span class=sb>n---
</span></span></span><span class=line><span class=cl><span class=sb>        `</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>abstractedTheme</span> <span class=o>=</span> <span class=nx>abstractionResult</span><span class=p>.</span><span class=nx>text</span><span class=p>.</span><span class=nx>trim</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] æŠ½è±¡åŒ–åçš„ä¸»é¢˜ï¼š </span><span class=si>${</span><span class=nx>abstractedTheme</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 3. ä½¿ç”¨æŠ½è±¡åŒ–ä¸»é¢˜ç”Ÿæˆæ¨¡ä»¿æ–‡ç« 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>textGeneratorAgent</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Agent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Text Generator Agent&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>instructions</span>: <span class=kt>generatedClonePrompt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>model</span>: <span class=kt>llm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] æ­£åœ¨ä½¿ç”¨æŠ½è±¡åŒ–ä¸»é¢˜ç”Ÿæˆæ–‡ç« ...`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>generatedTextResult</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>textGeneratorAgent</span><span class=p>.</span><span class=nx>generate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sb>`è¯·é’ˆå¯¹â€œ</span><span class=si>${</span><span class=nx>abstractedTheme</span><span class=si>}</span><span class=sb>â€ï¼Œåˆ›å»ºä¸€ç¯‡å³ä½¿æ˜¯åˆå­¦è€…ä¹Ÿèƒ½å®¹æ˜“ç†è§£çš„è§£è¯´æ–‡ç« ã€‚`</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>generatedText</span> <span class=o>=</span> <span class=nx>generatedTextResult</span><span class=p>.</span><span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 4. è¯„ä¼°ç›¸ä¼¼åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] æ­£åœ¨è¯„ä¼°ç”Ÿæˆçš„æ–‡ç« ä¸èŒƒæœ¬æ–‡ç« çš„ç›¸ä¼¼åº¦...`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>authorshipMetric</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AuthorshipSimilarityMetric</span><span class=p>(</span><span class=nx>llm</span><span class=p>);</span> <span class=c1>// ä½¿ç”¨è¯„ä¼°æŒ‡æ ‡
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>metricResult</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>authorshipMetric</span><span class=p>.</span><span class=nx>measure</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>originalText</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>generatedText</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>currentScore</span> <span class=o>=</span> <span class=nx>metricResult</span><span class=p>.</span><span class=nx>score</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>reason</span> <span class=o>=</span> <span class=nx>metricResult</span><span class=p>.</span><span class=nx>info</span><span class=p>.</span><span class=nx>reason</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] è¯„ä¼°ç»“æœ - åˆ†æ•°ï¼š </span><span class=si>${</span><span class=nx>currentScore</span><span class=p>.</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>, ç†ç”±ï¼š </span><span class=si>${</span><span class=nx>reason</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 5. æ ¹æ®è¯„ä¼°åˆ†æ•°åˆ¤æ–­å¾ªç¯ç»§ç»­/ç»“æŸ
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kr>const</span> <span class=nx>shouldStop</span> <span class=o>=</span> <span class=nx>currentScore</span> <span class=o>&gt;=</span> <span class=nx>SIMILARITY_THRESHOLD</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>shouldStop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>feedbackForPromptCreator</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>          ---
</span></span></span><span class=line><span class=cl><span class=sb>          **æ¥è‡ªä¸Šæ¬¡å°è¯•çš„åé¦ˆï¼ˆå¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>ï¼‰ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>          ä½¿ç”¨ç”Ÿæˆçš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€è®©å…¶ä¹¦å†™å…³äºâ€œ</span><span class=si>${</span><span class=nx>abstractedTheme</span><span class=si>}</span><span class=sb>â€çš„å†…å®¹åï¼Œä¸èŒƒæœ¬æ–‡ç« çš„ç›¸ä¼¼åº¦æœªè¾¾åˆ°ç›®æ ‡ï¼ˆåˆ†æ•°ï¼š </span><span class=si>${</span><span class=nx>currentScore</span><span class=p>.</span><span class=nx>toFixed</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=sb>ï¼‰ã€‚
</span></span></span><span class=line><span class=cl><span class=sb>          è¯„ä¼° AI æŒ‡å‡ºäº†ä»¥ä¸‹å‡ ç‚¹ã€‚è¯·å‚è€ƒè¿™äº›å†…å®¹æ”¹è¿›æç¤ºã€‚
</span></span></span><span class=line><span class=cl><span class=sb>          **å¤±è´¥çš„æç¤ºï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>          \`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>          </span><span class=si>${</span><span class=nx>generatedClonePrompt</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>          \`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>          **è¯„ä¼° AI çš„æŒ‡æ­£ï¼š**
</span></span></span><span class=line><span class=cl><span class=sb>          \`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>          </span><span class=si>${</span><span class=nx>reason</span><span class=si>}</span><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>          \`\`\`
</span></span></span><span class=line><span class=cl><span class=sb>          ---
</span></span></span><span class=line><span class=cl><span class=sb>            `</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] ç”±äºåˆ†æ•°ä½äºé˜ˆå€¼ï¼Œå°†åˆ›å»ºåé¦ˆå¹¶é‡è¯•ã€‚`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb>] ç”±äºåˆ†æ•°è¾¾åˆ°æˆ–è¶…è¿‡é˜ˆå€¼ (</span><span class=si>${</span><span class=nx>SIMILARITY_THRESHOLD</span><span class=si>}</span><span class=sb>)ï¼Œå°†ç»“æŸå¾ªç¯ã€‚`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>feedbackForPromptCreator</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span> <span class=c1>// æˆåŠŸåæ¸…é™¤åé¦ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`--- å¾ªç¯ </span><span class=si>${</span><span class=nx>iteration</span><span class=si>}</span><span class=sb> ç»“æŸ ---`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>shouldStop</span><span class=p>;</span> <span class=c1>// true åˆ™ç»“æŸå¾ªç¯ï¼Œfalse åˆ™ç»§ç»­
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=nx>generateClonePromptStep</span><span class=p>)</span> <span class=c1>// æŒ‡å®šå¾ªç¯æ‰§è¡Œçš„æ­¥éª¤
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>outputFinalPromptStep</span><span class=p>)</span> <span class=c1>// æŒ‡å®šå¾ªç¯ç»“æŸåæ‰§è¡Œçš„æ­¥éª¤
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>.</span><span class=nx>commit</span><span class=p>();</span> <span class=c1>// ç¡®å®šå·¥ä½œæµå®šä¹‰
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span> <span class=nx>clonePromptGeneratorWorkflow</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å®Œæˆæ¨¡ä»¿æŒ‡ç¤ºæç¤ºåŠå…¶ä½¿ç”¨æ–¹æ³•>å®Œæˆï¼â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€åŠå…¶ä½¿ç”¨æ–¹æ³•</h3><p><strong>æœ€ç»ˆè¾“å‡º</strong></p><p>å½“å·¥ä½œæµé¡ºåˆ©è¾¾åˆ°é˜ˆå€¼ä»¥ä¸Šçš„åˆ†æ•°å¹¶ç»“æŸåï¼Œæœ€ç»ˆå®Œæˆçš„â€œæ¨¡ä»¿æŒ‡ç¤ºæç¤ºâ€å°†è¾“å‡ºåˆ°ç»ˆç«¯æ§åˆ¶å°ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>--------------------------------------------------
</span></span><span class=line><span class=cl>å·¥ä½œæµå·²å®Œæˆï¼
</span></span><span class=line><span class=cl>æœ€ç»ˆç›¸ä¼¼åº¦åˆ†æ•°ï¼š 0.75ï¼ˆç¤ºä¾‹ï¼‰
</span></span><span class=line><span class=cl>æˆåŠŸçš„æ¨¡ä»¿æŒ‡ç¤ºæç¤ºï¼š
</span></span><span class=line><span class=cl>--------------------------------------------------
</span></span><span class=line><span class=cl># æŒ‡ç¤ºæç¤º
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ‚¨æ˜¯ä¸€ä¸ª AIï¼Œéœ€è¦æ¨¡ä»¿å…·æœ‰ä»¥ä¸‹ç‰¹å¾çš„äººç‰©ï¼Œæ ¹æ®ã€æ–‡ç« å†…å®¹ã€‘ç”Ÿæˆåƒäººä¸€æ ·è‡ªç„¶çš„æ–‡æœ¬ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## è¦æ¨¡ä»¿çš„äººç‰©ç‰¹å¾ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### äººæ ¼ï¼š
</span></span><span class=line><span class=cl>*   åŸºæœ¬æ€åº¦ï¼šç¤¼è²Œä¸”äº²åˆ‡ã€‚åŠªåŠ›é«˜æ•ˆåœ°ä¼ è¾¾ä¿¡æ¯ã€‚
</span></span><span class=line><span class=cl>*   è¯´è¯æ–¹å¼ï¼šè¯­æ°”æ¸©å’Œã€‚ä¹Ÿä¼šä½¿ç”¨åƒâ€œï½ãªæ„Ÿã˜ã§ã™â€è¿™æ ·çš„è¡¨è¾¾ï¼Œä½†æ­¥éª¤è¯´æ˜å¾ˆå¹²ç»ƒã€‚
</span></span><span class=line><span class=cl>*   æ€ç»´ï¼šé€»è¾‘æ€§å¼ºä½†çµæ´»ã€‚æ³¨é‡å®è·µã€‚
</span></span><span class=line><span class=cl>...ï¼ˆä»¥ä¸‹æ˜¯ AI ç”Ÿæˆçš„æç¤ºå†…å®¹ï¼‰...
</span></span><span class=line><span class=cl>--------------------------------------------------
</span></span></code></pre></td></tr></table></div></div><p>å°†è¿™ä¸ªè¾“å‡ºçš„æç¤ºå¤åˆ¶ä¸‹æ¥ï¼Œæ´»ç”¨åˆ°ä»Šåçš„æ–‡ç« ç”Ÿæˆä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨ ChatGPT æˆ– Claude ç­‰å…¶ä»–å·¥å…·ä¸­ä½¿ç”¨æ—¶ï¼‰ï¼Œåº”è¯¥å°±èƒ½è®© AI åˆ¶ä½œæ¨¡ä»¿æ‚¨æ–‡é£çš„è‰ç¨¿äº†ï¼</p><h3 id=æ€»ç»“>æ€»ç»“</h3><p>è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ mastra çš„å¾ªç¯åŠŸèƒ½å’Œè¯„ä¼°åŠŸèƒ½ï¼Œå°è¯•åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œæµï¼Œè®© AI å­¦ä¹ è‡ªå·±çš„å†™ä½œé£æ ¼ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå’Œæ”¹è¿›ç”¨äºæ¨¡ä»¿è¯¥é£æ ¼çš„æç¤ºæœ¬èº«ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªè®© AI æ€è€ƒå¦‚ä½•ä½¿ç”¨ AI çš„ç¨å¾®æœ‰ç‚¹å…ƒè®¤çŸ¥æ„å‘³çš„æ–¹æ³•ï¼Œä½†å¦‚æœé¡ºåˆ©çš„è¯ï¼Œåº”è¯¥èƒ½æé«˜æ–‡ç« å†™ä½œçš„æ•ˆç‡å§ã€‚ç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›æƒ³è¦ç”¨è‡ªå·±çš„é£æ ¼å†™åšå®¢æ–‡ç« æˆ–æŠ¥å‘Šï¼Œä½†åˆè§‰å¾—æ‰“å­—å¾ˆéº»çƒ¦çš„äººæ¥è¯´ï¼Œè¿™ä¹Ÿè®¸å€¼å¾—ä¸€è¯•ã€‚</p><p>mastra çœŸæ˜¯ä¸€ä¸ªç›¸å½“æœ‰æ·±åº¦ä¸”æœ‰è¶£çš„åº“ï¼å¤§å®¶ä¹Ÿè¯·åŠ¡å¿…å°è¯•åˆ›å»ºå„ç§å„æ ·çš„å·¥ä½œæµå§ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/zh-cn/tags/mastra/>Mastra</a>
<a href=/zh-cn/tags/typescript/>TypeScript</a>
<a href=/zh-cn/tags/grok/>Grok</a>
<a href=/zh-cn/tags/gemini/>Gemini</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/zh-cn/p/free-ai-models-create-threejs-game/><div class=article-image><img src=/p/free-ai-models-create-threejs-game/free-ai-models-create-threejs-game.e58640b9f9c13966bf9452e6e067ce58_hu_2de51dcfcd3d618.webp width=250 height=150 loading=lazy alt="Featured image of post å°è¯•ä½¿ç”¨æœ€æ–°çš„å…è´¹AIæ¨¡å‹ Gemini 2.5 Pro å’Œ Trae Builder å¼€å‘ Three.js æ¸¸æˆï¼" data-key=free-ai-models-create-threejs-game data-hash="md5-5YZAufnBOWa/lFLm4GfOWA=="></div><div class=article-details><h2 class=article-title>å°è¯•ä½¿ç”¨æœ€æ–°çš„å…è´¹AIæ¨¡å‹ Gemini 2.5 Pro å’Œ Trae Builder å¼€å‘ Three.js æ¸¸æˆï¼</h2></div></a></article><article class=has-image><a href=/zh-cn/p/registering-xai-grok-api-and-using-it-with-vscode-extensions-cody-cline-roo-code/><div class=article-image><img src=/p/registering-xai-grok-api-and-using-it-with-vscode-extensions-cody-cline-roo-code/xai_payment.73082bdeae438bad3640804a6a26137b_hu_d6b0f5dfbe541e27.webp width=250 height=150 loading=lazy alt="Featured image of post æ³¨å†ŒxAIï¼ˆGrok APIï¼‰å¹¶åœ¨VSCodeæ‰©å±•ï¼ˆCodyã€Clineã€Roo Codeï¼‰ä¸­ä½¿ç”¨" data-key=registering-xai-grok-api-and-using-it-with-vscode-extensions-cody-cline-roo-code data-hash="md5-cwgr3q5Di602QIBKaiYTew=="></div><div class=article-details><h2 class=article-title>æ³¨å†ŒxAIï¼ˆGrok APIï¼‰å¹¶åœ¨VSCodeæ‰©å±•ï¼ˆCodyã€Clineã€Roo Codeï¼‰ä¸­ä½¿ç”¨</h2></div></a></article><article class=has-image><a href=/zh-cn/p/rovo-dev-cli-guide-wsl2-blender/><div class=article-image><img src=/p/rovo-dev-cli-guide-wsl2-blender/rovo-dev-cli-guide-wsl2-blender.53c9331e345d1bef53c80de3491be75f_hu_8a9726256bf4bc98.webp width=250 height=150 loading=lazy alt="Featured image of post Rovo Dev CLIå®æˆ˜æŒ‡å—ï¼šå¦‚ä½•åœ¨VSCodeä¸WSL2ä¸­èˆ’é€‚åœ°ä½¿ç”¨" data-key=rovo-dev-cli-guide-wsl2-blender data-hash="md5-U8kzHjRdG+9TyA3jSRvnXw=="></div><div class=article-details><h2 class=article-title>Rovo Dev CLIå®æˆ˜æŒ‡å—ï¼šå¦‚ä½•åœ¨VSCodeä¸WSL2ä¸­èˆ’é€‚åœ°ä½¿ç”¨</h2></div></a></article><article class=has-image><a href=/zh-cn/p/roblox-ts-template-for-modern-development/><div class=article-image><img src=/p/roblox-ts-template-for-modern-development/roblox-ts-template-for-modern-development.7af396fd154e0b9d345e3a313784cbbd_hu_f03d539097d9cc41.webp width=250 height=150 loading=lazy alt="Featured image of post ä½¿ç”¨ Roblox (TypeScript) å’Œ VSCode çš„ç°ä»£å¼€å‘ç¯å¢ƒæ¨¡æ¿" data-key=roblox-ts-template-for-modern-development data-hash="md5-evOW/RVOC500XjoxN4TLvQ=="></div><div class=article-details><h2 class=article-title>ä½¿ç”¨ Roblox (TypeScript) å’Œ VSCode çš„ç°ä»£å¼€å‘ç¯å¢ƒæ¨¡æ¿</h2></div></a></article><article class=has-image><a href=/zh-cn/p/roblox-luau-template-for-modern-development/><div class=article-image><img src=/p/roblox-luau-template-for-modern-development/roblox-luau-template-for-modern-development.7af396fd154e0b9d345e3a313784cbbd_hu_f03d539097d9cc41.webp width=250 height=150 loading=lazy alt="Featured image of post Roblox (Luau) ä¸ VSCode çš„ç°ä»£å¼€å‘ç¯å¢ƒæ¨¡æ¿" data-key=roblox-luau-template-for-modern-development data-hash="md5-evOW/RVOC500XjoxN4TLvQ=="></div><div class=article-details><h2 class=article-title>Roblox (Luau) ä¸ VSCode çš„ç°ä»£å¼€å‘ç¯å¢ƒæ¨¡æ¿</h2></div></a></article></div></div></aside><link rel=stylesheet href=/scss/partials/comments/disqusjs.min.css><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>let disqusjs;function loadDisqusJS(){disqusjs=new DisqusJS({shortname:"takoyakisoft",siteName:"TakoyakiSoft",apikey:"eL3QpmMQaI2omMQ6bzIOJQaX35h7aYJz4zB1kn3puW2xAkjuN7N5rx2kq0WNeOrC",api:"https://disqus.skk.moe/disqus/",admin:"takoyakisoft",adminLabel:"takoyaki"})}function lazyLoadDisqusJS(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqus.js",e.async=!1,document.body.appendChild(e),e.onload=()=>{loadDisqusJS(),window.addEventListener("onColorSchemeChange",e=>{disqusjs&&loadDisqusJS()})}}let runningOnBrowser=typeof window!="undefined",isBot=runningOnBrowser&&!("onscroll"in window)||typeof navigator!="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;if(!isBot&&supportsIntersectionObserver){let e=new IntersectionObserver(function(t){t[0].isIntersecting&&(lazyLoadDisqusJS(),e.disconnect())});e.observe(document.getElementById("disqus_thread"))}else lazyLoadDisqusJS()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 TakoyakiSoft</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>